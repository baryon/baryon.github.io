(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{575:function(e,t,r){"use strict";r.r(t);var a=r(8),o=Object(a.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("p",[e._v("::: info")]),e._v(" "),r("p",[e._v("翻译自"),r("a",{attrs:{href:"https://developer.bitcoin.org/examples/payment_processing.html#payment-processing",target:"_blank",rel:"noopener noreferrer"}},[e._v("Payment Processing — Bitcoin"),r("OutboundLink")],1),e._v("\n内容在整理，准确性请自己确认")]),e._v(" "),r("p",[e._v(":::")]),e._v(" "),r("h1",{attrs:{id:"payment-processing-付款程序"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#payment-processing-付款程序"}},[e._v("#")]),e._v(" Payment Processing 付款程序"),r("a",{attrs:{href:"https://developer.bitcoin.org/examples/payment_processing.html#payment-processing",title:"Permalink to this headline",target:"_blank",rel:"noopener noreferrer"}},[r("OutboundLink")],1)]),e._v(" "),r("h2",{attrs:{id:"payment-protocol-付款程序"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#payment-protocol-付款程序"}},[e._v("#")]),e._v(" Payment Protocol 付款程序"),r("a",{attrs:{href:"https://developer.bitcoin.org/examples/payment_processing.html#payment-protocol",title:"Permalink to this headline",target:"_blank",rel:"noopener noreferrer"}},[r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("To request payment using the payment protocol, you use an extended (but backwards-compatible) "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-bitcoin-uri",target:"_blank",rel:"noopener noreferrer"}},[e._v("“bitcoin:” URI"),r("OutboundLink")],1),e._v(". For example:")]),e._v(" "),r("p",[e._v("要使用支付协议请求支付，您可以使用扩展(但向后兼容)的“ bitcoin: ” URI:")]),e._v(" "),r("p",[r("img",{staticClass:"lazy",attrs:{alt:"Warning icon","data-src":"https://developer.bitcoin.org/_images/icon_warning.svg",loading:"lazy"}}),e._v(" "),r("strong",[e._v("Warning:")]),e._v(" The payment protocol is considered to be deprecated and will be removed in a later version of Bitcoin Core. The protocol has multiple security design flaws and implementation flaws in some wallets. Users will begin receiving deprecation warnings in Bitcoin Core version 0.18 when using "),r("a",{attrs:{href:"https://github.com/bitcoin/bips/blob/master/bip-0070.mediawiki",target:"_blank",rel:"noopener noreferrer"}},[e._v("BIP70"),r("OutboundLink")],1),e._v(" URI’s. Merchants should transition away from "),r("a",{attrs:{href:"https://github.com/bitcoin/bips/blob/master/bip-0070.mediawiki",target:"_blank",rel:"noopener noreferrer"}},[e._v("BIP70"),r("OutboundLink")],1),e._v(" to more secure options such as "),r("a",{attrs:{href:"https://github.com/bitcoin/bips/blob/master/bip-0021.mediawiki",target:"_blank",rel:"noopener noreferrer"}},[e._v("BIP21"),r("OutboundLink")],1),e._v(". Merchants should never require "),r("a",{attrs:{href:"https://github.com/bitcoin/bips/blob/master/bip-0070.mediawiki",target:"_blank",rel:"noopener noreferrer"}},[e._v("BIP70"),r("OutboundLink")],1),e._v(" payments and should provide "),r("a",{attrs:{href:"https://github.com/bitcoin/bips/blob/master/bip-0021.mediawiki",target:"_blank",rel:"noopener noreferrer"}},[e._v("BIP21"),r("OutboundLink")],1),e._v(" fallbacks.")]),e._v(" "),r("p",[e._v("警告: 支付协议被认为是不推荐的，并将被删除在后来版本的比特币核心。该协议存在多种安全设计缺陷，部分钱包存在实现缺陷。当使用 BIP70 URI 时，用户将开始收到比特币核心0.18版本的弃用警告。商家应该从 BIP70过渡到更安全的选择，比如 BIP21。商家永远不应该要求 BIP70支付，应该提供 BIP21备用。")]),e._v(" "),r("p",[e._v("bitcoin:mjSk1Ny9spzU2fouzYgLqGUD8U41iR35QN"),r("br"),e._v("\n?amount=0.10"),r("br"),e._v("\n&label=Example+Merchant"),r("br"),e._v("\n&message=Order+of+flowers+%26+chocolates"),r("br"),e._v("\n&r=https://example.com/pay.php/invoice%3Dda39a3ee")]),e._v(" "),r("p",[e._v("The browser, QR code reader, or other program processing the URI opens the spender’s Bitcoin wallet program on the URI. If the wallet program is aware of the payment protocol, it accesses the URL specified in the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-r-parameter",target:"_blank",rel:"noopener noreferrer"}},[e._v("“r”"),r("OutboundLink")],1),e._v("parameter, which should provide it with a serialized "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentrequest",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentRequest"),r("OutboundLink")],1),e._v(" served with the "),r("a",{attrs:{href:"https://en.wikipedia.org/wiki/Internet_media_type",target:"_blank",rel:"noopener noreferrer"}},[e._v("MIME"),r("OutboundLink")],1),e._v(" type "),r("code",[e._v("application/bitcoin-paymentrequest")]),e._v(".")]),e._v(" "),r("p",[e._v("浏览器、二维码阅读器或其他处理 URI 的程序会在 URI 上打开挥金如土的比特币钱包程序。如果钱包程序知道支付协议，它会访问“ r”参数中指定的 URL，这将为它提供与 MIME 类型应用程序/比特币支付请求一起服务的序列化 PaymentRequest。")]),e._v(" "),r("p",[r("strong",[e._v("Resource:")]),e._v(" Gavin Andresen’s "),r("a",{attrs:{href:"https://github.com/gavinandresen/paymentrequest/blob/master/php/demo_website/createpaymentrequest.php",target:"_blank",rel:"noopener noreferrer"}},[e._v("Payment Request Generator"),r("OutboundLink")],1),e._v(" generates custom example URIs and payment requests for use with testnet.")]),e._v(" "),r("p",[e._v("资源: Gavin Andresen 的支付请求生成器生成用于 testnet 的定制样例 uri 和支付请求。")]),e._v(" "),r("h3",{attrs:{id:"paymentrequest-paymentdetails-支付请求和支付详细信息"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#paymentrequest-paymentdetails-支付请求和支付详细信息"}},[e._v("#")]),e._v(" PaymentRequest & PaymentDetails 支付请求和支付详细信息"),r("a",{attrs:{href:"https://developer.bitcoin.org/examples/payment_processing.html#paymentrequest-paymentdetails",title:"Permalink to this headline",target:"_blank",rel:"noopener noreferrer"}},[r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("The "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentrequest",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentRequest"),r("OutboundLink")],1),e._v(" is created with data structures built using Google’s "),r("a",{attrs:{href:"https://developers.google.com/protocol-buffers/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Protocol Buffers"),r("OutboundLink")],1),e._v(". "),r("a",{attrs:{href:"https://github.com/bitcoin/bips/blob/master/bip-0070.mediawiki",target:"_blank",rel:"noopener noreferrer"}},[e._v("BIP70"),r("OutboundLink")],1),e._v(" describes these data structures in the non-sequential way they’re defined in the payment request "),r("a",{attrs:{href:"https://developers.google.com/protocol-buffers/",target:"_blank",rel:"noopener noreferrer"}},[e._v("protocol buffer"),r("OutboundLink")],1),e._v(" code, but the text below will describe them in a more linear order using a simple (but functional) Python CGI program. (For brevity and clarity, many normal CGI best practices are not used in this program.)")]),e._v(" "),r("p",[e._v("支付请求是使用谷歌的协议缓冲数据结构创建的。BIP70以非顺序的方式描述了这些数据结构，它们是在支付请求协议缓冲代码中定义的，但是下面的文本将使用一个简单的(但是功能性的) Python CGI 程序以更加线性的顺序描述它们。(为了简洁和清晰，许多常规的 CGI 最佳实践在本程序中没有使用。)")]),e._v(" "),r("p",[e._v("The full sequence of events is illustrated below, starting with the spender clicking a "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-bitcoin-uri",target:"_blank",rel:"noopener noreferrer"}},[e._v("“bitcoin:” URI"),r("OutboundLink")],1),e._v(" or scanning a "),r("code",[e._v("bitcoin:")]),e._v(" QR code.")]),e._v(" "),r("p",[e._v("完整的事件序列如下图所示，从挥金如土的人点击“比特币: ” URI 或扫描比特币: QR 码开始。")]),e._v(" "),r("p",[r("img",{staticClass:"lazy",attrs:{alt:"BIP70 Payment Protocol","data-src":"https://developer.bitcoin.org/_images/en-payment-protocol.svg",loading:"lazy"}})]),e._v(" "),r("p",[e._v("BIP70 Payment Protocol"),r("a",{attrs:{href:"https://developer.bitcoin.org/examples/payment_processing.html#id1",title:"Permalink to this image",target:"_blank",rel:"noopener noreferrer"}},[r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("支付协议")]),e._v(" "),r("p",[e._v("For the script to use the "),r("a",{attrs:{href:"https://developers.google.com/protocol-buffers/",target:"_blank",rel:"noopener noreferrer"}},[e._v("protocol buffer"),r("OutboundLink")],1),e._v(", you will need a copy of Google’s "),r("a",{attrs:{href:"https://developers.google.com/protocol-buffers/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Protocol Buffer"),r("OutboundLink")],1),e._v(" compiler ("),r("code",[e._v("protoc")]),e._v("), which is available in most modern Linux package managers and "),r("a",{attrs:{href:"https://developers.google.com/protocol-buffers/",target:"_blank",rel:"noopener noreferrer"}},[e._v("directly from Google."),r("OutboundLink")],1),e._v(" Non-Google "),r("a",{attrs:{href:"https://developers.google.com/protocol-buffers/",target:"_blank",rel:"noopener noreferrer"}},[e._v("protocol buffer"),r("OutboundLink")],1),e._v(" compilers are available for a variety of programming languages. You will also need a copy of the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentrequest",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentRequest"),r("OutboundLink")],1),e._v(" "),r("a",{attrs:{href:"https://github.com/bitcoin/bitcoin/blob/0.19/src/qt/paymentrequest.proto",target:"_blank",rel:"noopener noreferrer"}},[e._v("Protocol Buffer description"),r("OutboundLink")],1),e._v(" from the Bitcoin Core source code.")]),e._v(" "),r("p",[e._v("对于使用协议缓冲区的脚本，您将需要一个 Google 的 Protocol Buffer 编译器(protoc)的副本，这个副本可以在大多数现代 Linux 包管理器中使用，也可以直接从 Google 获得。非谷歌协议缓冲编译器可用于各种编程语言。您还需要一个来自比特币核心源代码的 PaymentRequest 协议缓冲描述的副本。")]),e._v(" "),r("h4",{attrs:{id:"initialization-code-初始化代码"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#initialization-code-初始化代码"}},[e._v("#")]),e._v(" Initialization Code 初始化代码"),r("a",{attrs:{href:"https://developer.bitcoin.org/examples/payment_processing.html#initialization-code",title:"Permalink to this headline",target:"_blank",rel:"noopener noreferrer"}},[r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("With the Python code generated by "),r("code",[e._v("protoc")]),e._v(", we can start our simple CGI program.")]),e._v(" "),r("p",[e._v("使用 protoc 生成的 Python 代码，我们可以启动简单的 CGI 程序。")]),e._v(" "),r("p",[e._v("#!/usr/bin/env python")]),e._v(" "),r("h2",{attrs:{id:"this-is-the-code-generated-by-protoc-python-out-paymentrequest-paymentrequest-proto"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#this-is-the-code-generated-by-protoc-python-out-paymentrequest-paymentrequest-proto"}},[e._v("#")]),e._v(" This is the code generated by protoc --python_out=./ [paymentrequest][paymentrequest].proto")]),e._v(" "),r("p",[e._v("from paymentrequest_pb2 import *")]),e._v(" "),r("h2",{attrs:{id:"load-some-functions"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#load-some-functions"}},[e._v("#")]),e._v(" Load some functions")]),e._v(" "),r("p",[e._v("from time import time\nfrom sys import stdout\nfrom OpenSSL.crypto import FILETYPE_PEM, load_privatekey, sign")]),e._v(" "),r("h2",{attrs:{id:"copy-three-of-the-classes-created-by-protoc-into-objects-we-can-use"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#copy-three-of-the-classes-created-by-protoc-into-objects-we-can-use"}},[e._v("#")]),e._v(" Copy three of the classes created by protoc into objects we can use")]),e._v(" "),r("p",[e._v("details = [PaymentDetails]"),r("a",{attrs:{href:""}},[e._v("paymentdetails")]),e._v("\nrequest = [PaymentRequest]"),r("a",{attrs:{href:""}},[e._v("paymentrequest")]),e._v("\nx509 = [X509Certificates]"),r("a",{attrs:{href:""}},[e._v("x509certificates")])]),e._v(" "),r("p",[e._v("The startup code above is quite simple, requiring nothing but the epoch (Unix date) time function, the standard out file descriptor, a few functions from the OpenSSL library, and the data structures and functions created by "),r("code",[e._v("protoc")]),e._v(".")]),e._v(" "),r("p",[e._v("上面的启动代码非常简单，只需要 epoch (Unix date) time 函数、标准输出文件描述符、 OpenSSL 库中的一些函数以及由 protoc 创建的数据结构和函数。")]),e._v(" "),r("h4",{attrs:{id:"configuration-code-配置代码"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#configuration-code-配置代码"}},[e._v("#")]),e._v(" Configuration Code 配置代码"),r("a",{attrs:{href:"https://developer.bitcoin.org/examples/payment_processing.html#configuration-code",title:"Permalink to this headline",target:"_blank",rel:"noopener noreferrer"}},[r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("Next, we’ll set configuration settings which will typically only change when the receiver wants to do something differently. The code pushes a few settings into the "),r("code",[e._v("request")]),e._v(" ("),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentrequest",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentRequest"),r("OutboundLink")],1),e._v(") and "),r("code",[e._v("details")]),e._v(" ("),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentdetails",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentDetails"),r("OutboundLink")],1),e._v(") objects. When we serialize them, "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentdetails",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentDetails"),r("OutboundLink")],1),e._v(" will be contained within the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentrequest",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentRequest"),r("OutboundLink")],1),e._v(".")]),e._v(" "),r("p",[e._v("接下来，我们将设置配置设置，这通常只有当接收者想要做一些不同的事情时才会改变。代码将一些设置推送到请求(PaymentRequest)和详细信息(PaymentDetails)对象中。序列化它们时，PaymentDetails 将包含在 PaymentRequest 中。")]),e._v(" "),r("h2",{attrs:{id:"ssl-signature-method"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#ssl-signature-method"}},[e._v("#")]),e._v(" SSL Signature method")]),e._v(" "),r("p",[e._v('request.pki_type = "x509+sha256"  ## Default: none')]),e._v(" "),r("h2",{attrs:{id:"mainnet-or-testnet"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#mainnet-or-testnet"}},[e._v("#")]),e._v(" Mainnet or testnet?")]),e._v(" "),r("p",[e._v('details.[network][network] = "test"  ## Default: main')]),e._v(" "),r("h2",{attrs:{id:"postback-url"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#postback-url"}},[e._v("#")]),e._v(" Postback URL")]),e._v(" "),r("p",[e._v('details.payment_url = "https://example.com/pay.py"')]),e._v(" "),r("h2",{attrs:{id:"paymentdetails-paymentdetails-version-number"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#paymentdetails-paymentdetails-version-number"}},[e._v("#")]),e._v(" [PaymentDetails][paymentdetails] version number")]),e._v(" "),r("p",[e._v("request.payment_details_version = 1  ## Default: 1")]),e._v(" "),r("h2",{attrs:{id:"certificate-chain-certificate-chain"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#certificate-chain-certificate-chain"}},[e._v("#")]),e._v(" [Certificate chain][certificate chain]")]),e._v(" "),r("p",[e._v('x509.certificate.append(file("/etc/apache2/example.com-cert.[der][der]", "r").read())\n#x509.certificate.append(file("/some/intermediate/cert.[der][der]", "r").read())')]),e._v(" "),r("h2",{attrs:{id:"load-private-ssl-key-into-memory-for-signing-later"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#load-private-ssl-key-into-memory-for-signing-later"}},[e._v("#")]),e._v(" Load private SSL key into memory for signing later")]),e._v(" "),r("p",[e._v('priv_key = "/etc/apache2/example.com-key.pem"\npw = "test"  ## Key password\nprivate_key = load_privatekey(FILETYPE_PEM, file(priv_key, "r").read(), pw)')]),e._v(" "),r("p",[e._v("Each line is described below.")]),e._v(" "),r("p",[e._v("每一行都在下面描述。")]),e._v(" "),r("p",[e._v('request.pki_type = "x509+sha256"  ## Default: none')]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-pp-pki-type",target:"_blank",rel:"noopener noreferrer"}},[e._v("“pki_type”"),r("OutboundLink")],1),e._v(": (optional) tell the receiving wallet program what "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-pki",target:"_blank",rel:"noopener noreferrer"}},[e._v("Public-Key Infrastructure"),r("OutboundLink")],1),e._v(" ("),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-pki",target:"_blank",rel:"noopener noreferrer"}},[e._v("PKI"),r("OutboundLink")],1),e._v(") type you’re using to cryptographically sign your "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentrequest",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentRequest"),r("OutboundLink")],1),e._v(" so that it can’t be modified by a "),r("a",{attrs:{href:"https://en.wikipedia.org/wiki/Man-in-the-middle_attack",target:"_blank",rel:"noopener noreferrer"}},[e._v("man-in-the-middle"),r("OutboundLink")],1),e._v(" attack.")]),e._v(" "),r("p",[e._v("“ PKI _ type” : (可选)告诉接收钱包程序你正在使用什么公开金钥基础建设(PKI)类型来对你的付款请求进行加密签名，这样它就不会被中间人攻击修改。")]),e._v(" "),r("p",[e._v("If you don’t want to sign the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentrequest",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentRequest"),r("OutboundLink")],1),e._v(", you can choose a "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-pp-pki-type",target:"_blank",rel:"noopener noreferrer"}},[e._v("“pki_type”"),r("OutboundLink")],1),e._v(" of "),r("code",[e._v("none")]),e._v(" (the default).")]),e._v(" "),r("p",[e._v("如果您不想签署 PaymentRequest，可以选择“ pki _ type”为 none (默认值)。")]),e._v(" "),r("p",[e._v("If you do choose the sign the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentrequest",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentRequest"),r("OutboundLink")],1),e._v(", you currently have two options defined by "),r("a",{attrs:{href:"https://github.com/bitcoin/bips/blob/master/bip-0070.mediawiki",target:"_blank",rel:"noopener noreferrer"}},[e._v("BIP70"),r("OutboundLink")],1),e._v(": "),r("code",[e._v("x509+sha1")]),e._v("and "),r("code",[e._v("x509+sha256")]),e._v(". Both options use the "),r("a",{attrs:{href:"https://en.wikipedia.org/wiki/X.509",target:"_blank",rel:"noopener noreferrer"}},[e._v("X.509"),r("OutboundLink")],1),e._v(" certificate system, the same system used for HTTP Secure (HTTPS). To use either option, you will need a certificate signed by a certificate authority or one of their intermediaries. (A self-signed certificate will not work.)")]),e._v(" "),r("p",[e._v("如果您确实选择了签名 PaymentRequest，那么您目前有两个由 BIP70定义的选项: x509 + sha1和 x509 + sha256。这两个选项都使用 x. 509证书系统，该系统与 HTTP 安全(HTTPS)使用的系统相同。要使用这两个选项中的任何一个，您都需要由证书颁发机构或其中介机构签署的证书。(自签名证书不起作用。)")]),e._v(" "),r("p",[e._v("Each wallet program may choose which certificate authorities to trust, but it’s likely that they’ll trust whatever certificate authorities their operating system trusts. If the wallet program doesn’t have a full operating system, as might be the case for small hardware wallets, "),r("a",{attrs:{href:"https://github.com/bitcoin/bips/blob/master/bip-0070.mediawiki",target:"_blank",rel:"noopener noreferrer"}},[e._v("BIP70"),r("OutboundLink")],1),e._v(" suggests they use the "),r("a",{attrs:{href:"https://www.mozilla.org/en-US/about/governance/policies/security-group/certs/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Mozilla Root Certificate Store"),r("OutboundLink")],1),e._v(". In general, if a certificate works in your web browser when you connect to your webserver, it will work for your "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentrequest",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentRequests"),r("OutboundLink")],1),e._v(".")]),e._v(" "),r("p",[e._v("每个钱包程序可以选择要信任的证书颁发机构，但是它们很可能会信任任何操作系统信任的证书颁发机构。如果钱包程序没有一个完整的操作系统，就像小型硬件钱包一样，BIP70建议他们使用 Mozilla 根证书商店。一般来说，如果连接到 web 服务器时证书在您的 web 浏览器中工作，那么它将适用于您的 PaymentRequests。")]),e._v(" "),r("p",[e._v('details.[network][network] = "test"  ## Default: main')]),e._v(" "),r("p",[r("code",[e._v("network")]),e._v(": (optional) tell the spender’s wallet program what Bitcoin "),r("a",{attrs:{href:"https://developer.bitcoin.org/devguide/p2p_network.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("network"),r("OutboundLink")],1),e._v(" you’re using; "),r("a",{attrs:{href:"https://github.com/bitcoin/bips/blob/master/bip-0070.mediawiki",target:"_blank",rel:"noopener noreferrer"}},[e._v("BIP70"),r("OutboundLink")],1),e._v(" defines “main” for mainnet (actual payments) and “test” for testnet (like mainnet, but fake satoshis are used). If the wallet program doesn’t run on the "),r("a",{attrs:{href:"https://developer.bitcoin.org/devguide/p2p_network.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("network"),r("OutboundLink")],1),e._v(" you indicate, it will reject the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentrequest",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentRequest"),r("OutboundLink")],1),e._v(".")]),e._v(" "),r("p",[e._v("Network: (可选)告诉消费者的钱包程序你使用的是哪个比特币网络; BIP70为 mainnet 定义了“ main”(实际支付) ，为 testnet 定义了“ test”(比如 mainnet，但使用的是假的 satoshis)。如果钱包程序没有在您指示的网络上运行，它将拒绝 PaymentRequest。")]),e._v(" "),r("p",[e._v('details.payment_url = "https://example.com/pay.py"')]),e._v(" "),r("p",[r("code",[e._v("payment_url")]),e._v(": (required) tell the spender’s wallet program where to send the Payment message (described later). This can be a static URL, as in this example, or a variable URL such as "),r("code",[e._v("https://example.com/pay.py?invoice=123.")]),e._v(" It should usually be an HTTPS address to prevent "),r("a",{attrs:{href:"https://en.wikipedia.org/wiki/Man-in-the-middle_attack",target:"_blank",rel:"noopener noreferrer"}},[e._v("man-in-the-middle"),r("OutboundLink")],1),e._v(" attacks from modifying the message.")]),e._v(" "),r("p",[e._v("Payment _ url: (必需的)告诉消费者的钱包程序在哪里发送付款消息(后面将描述)。这可以是一个静态 URL，如本例中所示，也可以是一个变量 URL，如 https://example.com/pay.py?invoice=123。它通常应该是一个 HTTPS 地址，以防止中间人攻击修改消息。")]),e._v(" "),r("p",[e._v("request.payment_details_version = 1  ## Default: 1")]),e._v(" "),r("p",[r("code",[e._v("payment_details_version")]),e._v(": (optional) tell the spender’s wallet program what version of the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentdetails",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentDetails"),r("OutboundLink")],1),e._v("you’re using. As of this writing, the only version is version 1.")]),e._v(" "),r("p",[e._v("支付详情版本: (可选)告诉消费者的钱包程序你使用的是哪个版本的支付详情。在写这篇文章时，唯一的版本是版本1。")]),e._v(" "),r("h2",{attrs:{id:"this-is-the-pubkey-certificate-corresponding-to-the-private-ssl-key"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#this-is-the-pubkey-certificate-corresponding-to-the-private-ssl-key"}},[e._v("#")]),e._v(" This is the pubkey/certificate corresponding to the private SSL key")]),e._v(" "),r("h2",{attrs:{id:"that-we-ll-use-to-sign"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#that-we-ll-use-to-sign"}},[e._v("#")]),e._v(" that we'll use to sign:")]),e._v(" "),r("p",[e._v('x509.certificate.append(file("/etc/apache2/example.com-cert.[der][der]", "r").read())')]),e._v(" "),r("p",[r("code",[e._v("x509certificates")]),e._v(": (required for signed "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentrequest",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentRequests"),r("OutboundLink")],1),e._v(") you must provide the public SSL key/certificate corresponding to the private SSL key you’ll use to sign the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentrequest",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentRequest"),r("OutboundLink")],1),e._v(". The certificate must be in ASN.1/"),r("a",{attrs:{href:"https://en.wikipedia.org/wiki/X.690#DER_encoding",target:"_blank",rel:"noopener noreferrer"}},[e._v("DER format"),r("OutboundLink")],1),e._v(".")]),e._v(" "),r("p",[e._v("X509certificates: (签名的 PaymentRequests 需要)您必须提供与用于签名 PaymentRequest 的私有 SSL 密钥相对应的公共 SSL 密钥/证书。证书必须是 ASN. 1/DER 格式。")]),e._v(" "),r("h2",{attrs:{id:"if-the-pubkey-cert-above-didn-t-have-the-signature-of-a-root"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#if-the-pubkey-cert-above-didn-t-have-the-signature-of-a-root"}},[e._v("#")]),e._v(" If the pubkey/cert above didn't have the signature of a root")]),e._v(" "),r("h2",{attrs:{id:"certificate-authority-we-d-then-append-the-intermediate-certificate-intermediate-certificate"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#certificate-authority-we-d-then-append-the-intermediate-certificate-intermediate-certificate"}},[e._v("#")]),e._v(" certificate authority, we'd then append the [intermediate certificate][intermediate certificate]")]),e._v(" "),r("h2",{attrs:{id:"which-signed-it"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#which-signed-it"}},[e._v("#")]),e._v(" which signed it:")]),e._v(" "),r("p",[e._v('#x509.certificate.append(file("/some/intermediate/cert.[der][der]", "r").read())')]),e._v(" "),r("p",[e._v("You must also provide any "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-intermediate-certificate",target:"_blank",rel:"noopener noreferrer"}},[e._v("intermediate certificates"),r("OutboundLink")],1),e._v(" necessary to link your certificate to the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-root-certificate",target:"_blank",rel:"noopener noreferrer"}},[e._v("root certificate"),r("OutboundLink")],1),e._v(" of a certificate authority trusted by the spender’s software, such as a certificate from the Mozilla root store.")]),e._v(" "),r("p",[e._v("您还必须提供任何必要的中间证书，以便将证书链接到消费者软件信任的证书颁发机构的证书根证书，例如来自 Mozilla 根存储的证书。")]),e._v(" "),r("p",[e._v("The certificates must be provided in a specific order—the same order used by Apache’s "),r("code",[e._v("SSLCertificateFile")]),e._v("directive and other server software. The figure below shows the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-certificate-chain",target:"_blank",rel:"noopener noreferrer"}},[e._v("certificate chain"),r("OutboundLink")],1),e._v(" of the www.bitcoin.org "),r("a",{attrs:{href:"https://en.wikipedia.org/wiki/X.509",target:"_blank",rel:"noopener noreferrer"}},[e._v("X.509"),r("OutboundLink")],1),e._v("certificate and how each certificate (except the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-root-certificate",target:"_blank",rel:"noopener noreferrer"}},[e._v("root certificate"),r("OutboundLink")],1),e._v(") would be loaded into the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-x509certificates",target:"_blank",rel:"noopener noreferrer"}},[e._v("X509Certificates"),r("OutboundLink")],1),r("a",{attrs:{href:"https://developers.google.com/protocol-buffers/",target:"_blank",rel:"noopener noreferrer"}},[e._v("protocol buffer"),r("OutboundLink")],1),e._v(" message.")]),e._v(" "),r("p",[e._v("证书必须以特定的顺序提供ーー与 Apache 的 SSLCertificateFile 指令和其他服务器软件使用的顺序相同。下图显示了 www.bitcoin.org x. 509证书的证书链，以及如何将每个证书(根证书证书除外)加载到 X509Certificates protocol buffer 消息中。")]),e._v(" "),r("p",[r("img",{staticClass:"lazy",attrs:{alt:"X509Certificates Loading Order","data-src":"https://developer.bitcoin.org/_images/en-cert-order.svg",loading:"lazy"}})]),e._v(" "),r("p",[e._v("X509Certificates Loading Order"),r("a",{attrs:{href:"https://developer.bitcoin.org/examples/payment_processing.html#id2",title:"Permalink to this image",target:"_blank",rel:"noopener noreferrer"}},[r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("To be specific, the first certificate provided must be the "),r("a",{attrs:{href:"https://en.wikipedia.org/wiki/X.509",target:"_blank",rel:"noopener noreferrer"}},[e._v("X.509"),r("OutboundLink")],1),e._v(" certificate corresponding to the private SSL key which will make the signature, called the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-leaf-certificate",target:"_blank",rel:"noopener noreferrer"}},[e._v("leaf certificate"),r("OutboundLink")],1),e._v(". Any "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-intermediate-certificate",target:"_blank",rel:"noopener noreferrer"}},[e._v("intermediate certificates"),r("OutboundLink")],1),e._v(" necessary to link that signed public SSL key to the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-root-certificate",target:"_blank",rel:"noopener noreferrer"}},[e._v("root certificate"),r("OutboundLink")],1),e._v(" (the certificate authority) are attached separately, with each certificate in "),r("a",{attrs:{href:"https://en.wikipedia.org/wiki/X.690#DER_encoding",target:"_blank",rel:"noopener noreferrer"}},[e._v("DER format"),r("OutboundLink")],1),e._v(" bearing the signature of the certificate that follows it all the way to (but not including) the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-root-certificate",target:"_blank",rel:"noopener noreferrer"}},[e._v("root certificate"),r("OutboundLink")],1),e._v(".")]),e._v(" "),r("p",[e._v("具体地说，所提供的第一个证书必须是与私有 SSL 密钥相对应的 x. 509证书，该私有 SSL 密钥将生成签名(称为叶证书)。任何必要的中间证书，将签署的公共 SSL 密钥链接到证书中心(认证机构)都是单独附加的，每个 DER 格式的证书都带有证书的签名，一直到(但不包括)根证书中心。")]),e._v(" "),r("p",[e._v('priv_key = "/etc/apache2/example.com-key.pem"\npw = "test"  ## Key password\nprivate_key = load_privatekey(FILETYPE_PEM, file(priv_key, "r").read(), pw)')]),e._v(" "),r("p",[e._v("(Required for signed "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentrequest",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentRequests"),r("OutboundLink")],1),e._v(") you will need a private SSL key in a format your SSL library supports ("),r("a",{attrs:{href:"https://en.wikipedia.org/wiki/X.690#DER_encoding",target:"_blank",rel:"noopener noreferrer"}},[e._v("DER format"),r("OutboundLink")],1),e._v(" is not required). In this program, we’ll load it from a PEM file. (Embedding your passphrase in your CGI code, as done here, is obviously a bad idea in real life.)")]),e._v(" "),r("p",[e._v("(需要签名的付款请求)您将需要一个您的 SSL 库支持的格式的私有 SSL 密钥(不需要 DER 格式)。在这个程序中，我们将从 PEM 文件加载它。(在 CGI 代码中嵌入密码，就像这里做的一样，在现实生活中显然是个坏主意。)")]),e._v(" "),r("p",[e._v("The private SSL key will not be transmitted with your request. We’re only loading it into memory here so we can use it to sign the request later.")]),e._v(" "),r("p",[e._v("私有 SSL 密钥不会随您的请求一起传输。我们只是将它加载到这里的内存中，这样以后我们就可以使用它来签署请求。")]),e._v(" "),r("h4",{attrs:{id:"code-variables-代码变量"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#code-variables-代码变量"}},[e._v("#")]),e._v(" Code Variables 代码变量"),r("a",{attrs:{href:"https://developer.bitcoin.org/examples/payment_processing.html#code-variables",title:"Permalink to this headline",target:"_blank",rel:"noopener noreferrer"}},[r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("Now let’s look at the variables your CGI program will likely set for each payment.")]),e._v(" "),r("p",[e._v("现在让我们来看看您的 CGI 程序可能为每次付款设置的变量。")]),e._v(" "),r("h2",{attrs:{id:"amount-of-the-request"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#amount-of-the-request"}},[e._v("#")]),e._v(" Amount of the request")]),e._v(" "),r("p",[e._v("amount = 10000000  ## In satoshis")]),e._v(" "),r("h2",{attrs:{id:"p2pkh-pubkey-hash"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#p2pkh-pubkey-hash"}},[e._v("#")]),e._v(" P2PKH pubkey hash")]),e._v(" "),r("p",[e._v('pubkey_hash = "2b14950b8d31620c6cc923c5408a701b1ec0a020"')]),e._v(" "),r("h2",{attrs:{id:"p2pkh-pubkey-script-entered-as-hex-and-converted-to-binary"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#p2pkh-pubkey-script-entered-as-hex-and-converted-to-binary"}},[e._v("#")]),e._v(" P2PKH pubkey script entered as hex and converted to binary")]),e._v(" "),r("h1",{attrs:{id:"op-dup-op-hash160-push-20-bytes-op-equalverify-op-checksig"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#op-dup-op-hash160-push-20-bytes-op-equalverify-op-checksig"}},[e._v("#")]),e._v(" OP_DUP OP_HASH160 <push 20 bytes> "),r("pubKey",{attrs:{hash:""}},[e._v(" OP_EQUALVERIFY OP_CHECKSIG")])],1),e._v(" "),r("h1",{attrs:{id:"_76-a9-14-88-ac"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_76-a9-14-88-ac"}},[e._v("#")]),e._v(" 76       a9            14       "),r("pubKey",{attrs:{hash:""}},[e._v("        88          ac")])],1),e._v(" "),r("p",[e._v('hex_script = "76" + "a9" + "14" + pubkey_hash + "88" + "ac"\nserialized_script = hex_script.decode("hex")')]),e._v(" "),r("h2",{attrs:{id:"load-amount-and-pubkey-script-into-paymentdetails-paymentdetails"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#load-amount-and-pubkey-script-into-paymentdetails-paymentdetails"}},[e._v("#")]),e._v(" Load amount and pubkey script into [PaymentDetails][paymentdetails]")]),e._v(" "),r("p",[e._v("details.outputs.add(amount = amount, script = serialized_script)")]),e._v(" "),r("h2",{attrs:{id:"memo-to-display-to-the-spender"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#memo-to-display-to-the-spender"}},[e._v("#")]),e._v(" Memo to display to the spender")]),e._v(" "),r("p",[e._v('details.memo = "Flowers & chocolates"')]),e._v(" "),r("h2",{attrs:{id:"data-which-should-be-returned-to-you-with-the-payment"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#data-which-should-be-returned-to-you-with-the-payment"}},[e._v("#")]),e._v(" Data which should be returned to you with the payment")]),e._v(" "),r("p",[e._v('details.merchant_data = "Invoice #123"')]),e._v(" "),r("p",[e._v("Each line is described below.")]),e._v(" "),r("p",[e._v("每一行都在下面描述。")]),e._v(" "),r("p",[e._v("amount = 10000000  ## In satoshis (=100 mBTC)")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-pp-amount",target:"_blank",rel:"noopener noreferrer"}},[e._v("“amount”"),r("OutboundLink")],1),e._v(": (optional) the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-pp-amount",target:"_blank",rel:"noopener noreferrer"}},[e._v("amount"),r("OutboundLink")],1),e._v(" you want the spender to pay. You’ll probably get this value from your shopping cart application or "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-fiat",target:"_blank",rel:"noopener noreferrer"}},[e._v("fiat"),r("OutboundLink")],1),e._v("-to-BTC exchange rate conversion tool. If you leave the amount blank, the wallet program will prompt the spender how much to pay (which can be useful for donations).")]),e._v(" "),r("p",[e._v("“金额” : (可选)你希望消费者支付的金额。您可能会从您的购物车应用程序或菲亚特到 btc 的汇率转换工具得到这个值。如果你留下空白数额，钱包程序将提示消费者支付多少(这可能是有用的捐款)。")]),e._v(" "),r("p",[e._v('pubkey_hash = "2b14950b8d31620c6cc923c5408a701b1ec0a020"')]),e._v(" "),r("h1",{attrs:{id:"op-dup-op-hash160-push-20-bytes-op-equalverify-op-checksig-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#op-dup-op-hash160-push-20-bytes-op-equalverify-op-checksig-2"}},[e._v("#")]),e._v(" OP_DUP OP_HASH160 <push 20 bytes> "),r("pubKey",{attrs:{hash:""}},[e._v(" OP_EQUALVERIFY OP_CHECKSIG")])],1),e._v(" "),r("h1",{attrs:{id:"_76-a9-14-88-ac-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_76-a9-14-88-ac-2"}},[e._v("#")]),e._v(" 76       a9            14       "),r("pubKey",{attrs:{hash:""}},[e._v("        88          ac")])],1),e._v(" "),r("p",[e._v('hex_script = "76" + "a9" + "14" + pubkey_hash + "88" + "ac"\nserialized_script = hex_script.decode("hex")')]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-pp-script",target:"_blank",rel:"noopener noreferrer"}},[e._v("“script”"),r("OutboundLink")],1),e._v(": (required) You must specify the pubkey script you want the spender to pay—any valid pubkey script is acceptable. In this example, we’ll request payment to a P2PKH pubkey script.")]),e._v(" "),r("p",[e._v("“ script” : (必需的)您必须指定您希望花钱的 pubkey 脚本ー任何有效的 pubkey 脚本都是可以接受的。在这个示例中，我们将请求对 P2PKH pubkey 脚本的支付。")]),e._v(" "),r("p",[e._v("First we get a pubkey hash. The hash above is the hash form of the address used in the URI examples throughout this section, mjSk1Ny9spzU2fouzYgLqGUD8U41iR35QN.")]),e._v(" "),r("p",[e._v("首先我们得到一个 pubkey hash。上面的散列是整个部分的 URI 示例中使用的地址的散列形式，mjSk1Ny9spzU2fouzYgLqGUD8U41iR35QN。")]),e._v(" "),r("p",[e._v("Next, we plug that hash into the standard P2PKH pubkey script using hex, as illustrated by the code comments.")]),e._v(" "),r("p",[e._v("接下来，我们使用十六进制将该散列插入标准 P2PKH pubkey 脚本，如代码注释所示。")]),e._v(" "),r("p",[e._v("Finally, we convert the pubkey script from hex into its serialized form.")]),e._v(" "),r("p",[e._v("最后，我们将 pubkey 脚本从十六进制转换为它的序列化形式。")]),e._v(" "),r("p",[e._v("details.outputs.add(amount = amount, script = serialized_script)")]),e._v(" "),r("p",[r("code",[e._v("outputs")]),e._v(": (required) add the pubkey script and (optional) amount to the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentdetails",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentDetails"),r("OutboundLink")],1),e._v(" outputs array.")]),e._v(" "),r("p",[e._v("Output: (必需的)将 pubkey 脚本和(可选的) amount 添加到 PaymentDetails 输出数组。")]),e._v(" "),r("p",[e._v("It’s possible to specify multiple "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-pp-script",target:"_blank",rel:"noopener noreferrer"}},[e._v("“scripts”"),r("OutboundLink")],1),e._v(" and "),r("code",[e._v("amounts")]),e._v(" as part of a "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-merge-avoidance",target:"_blank",rel:"noopener noreferrer"}},[e._v("merge avoidance"),r("OutboundLink")],1),e._v(" strategy, described later in the "),r("a",{attrs:{href:"https://developer.bitcoin.org/devguide/payment_processing.html#merge-avoidance",target:"_blank",rel:"noopener noreferrer"}},[e._v("Merge Avoidance subsection"),r("OutboundLink")],1),e._v(". However, effective "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-merge-avoidance",target:"_blank",rel:"noopener noreferrer"}},[e._v("merge avoidance"),r("OutboundLink")],1),e._v(" is not possible under the base "),r("a",{attrs:{href:"https://github.com/bitcoin/bips/blob/master/bip-0070.mediawiki",target:"_blank",rel:"noopener noreferrer"}},[e._v("BIP70"),r("OutboundLink")],1),e._v("rules in which the spender pays each "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-pp-script",target:"_blank",rel:"noopener noreferrer"}},[e._v("“script”"),r("OutboundLink")],1),e._v(" the exact amount specified by its paired "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-pp-amount",target:"_blank",rel:"noopener noreferrer"}},[e._v("“amount”"),r("OutboundLink")],1),e._v(". If the amounts are omitted from all "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-pp-amount",target:"_blank",rel:"noopener noreferrer"}},[e._v("“amount”"),r("OutboundLink")],1),e._v("/"),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-pp-script",target:"_blank",rel:"noopener noreferrer"}},[e._v("“script”"),r("OutboundLink")],1),e._v(" pairs, the spender will be prompted to choose an amount to pay.")]),e._v(" "),r("p",[e._v("可以指定多个“脚本”和金额作为合并回避策略的一部分，在后面的合并回避小节中进行描述。然而，有效的合并规避是不可能的基础 BIP70规则，其中支付支付每个“脚本”的确切金额指定的配对“数额”。如果在所有“金额”/“脚本”对中省略了金额，将提示花钱者选择要支付的金额。")]),e._v(" "),r("p",[e._v('details.memo = "Flowers & chocolates"')]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-pp-memo",target:"_blank",rel:"noopener noreferrer"}},[e._v("“memo”"),r("OutboundLink")],1),e._v(": (optional) add a memo which will be displayed to the spender as plain UTF-8 text. Embedded HTML or other markup will not be processed.")]),e._v(" "),r("p",[e._v("“ memo” : (可选)添加一个备忘录，它将以 UTF-8文本的形式显示给消费者。不会处理嵌入式 HTML 或其他标记。")]),e._v(" "),r("p",[e._v('details.merchant_data = "Invoice #123"')]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-pp-merchant-data",target:"_blank",rel:"noopener noreferrer"}},[e._v("“merchant_data”"),r("OutboundLink")],1),e._v(": (optional) add arbitrary data which should be sent back to the receiver when the invoice is paid. You can use this to track your invoices, although you can more reliably track payments by generating a "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-unique-address",target:"_blank",rel:"noopener noreferrer"}},[e._v("unique address"),r("OutboundLink")],1),e._v(" for each payment and then tracking when it gets paid.")]),e._v(" "),r("p",[e._v("“ merchant _ data” : (可选)添加任意数据，这些数据应该在发票付款时发送回收件人。你可以使用这个来跟踪你的发票，虽然你可以通过为每个付款生成一个唯一的地址来更可靠地跟踪付款，然后跟踪付款的时间。")]),e._v(" "),r("p",[e._v("The "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-pp-memo",target:"_blank",rel:"noopener noreferrer"}},[e._v("“memo”"),r("OutboundLink")],1),e._v(" field can be arbitrarily long, but if you make them too long, you’ll run into the 50,000 byte limit on the entire "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentrequest",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentRequest"),r("OutboundLink")],1),e._v(", which includes the often several kilobytes given over to storing the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-certificate-chain",target:"_blank",rel:"noopener noreferrer"}},[e._v("certificate chain"),r("OutboundLink")],1),e._v(". As will be described in a later subsection, the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-pp-memo",target:"_blank",rel:"noopener noreferrer"}},[e._v("“memo”"),r("OutboundLink")],1),e._v(" field can be used by the spender after payment as part of a cryptographically-proven "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-receipt",target:"_blank",rel:"noopener noreferrer"}},[e._v("receipt"),r("OutboundLink")],1),e._v(".")]),e._v(" "),r("p",[e._v("“ memo”字段可以任意长，但是如果长度太长，就会在整个 PaymentRequest 中遇到50,000字节的限制，这个限制通常包括用于存储证书链的几千字节。如后面的小节所述，“ memo”字段可以作为经过密码验证的收据的一部分，供支付者在付款后使用。")]),e._v(" "),r("h4",{attrs:{id:"derivable-data-可推导数据"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#derivable-data-可推导数据"}},[e._v("#")]),e._v(" Derivable Data 可推导数据"),r("a",{attrs:{href:"https://developer.bitcoin.org/examples/payment_processing.html#derivable-data",title:"Permalink to this headline",target:"_blank",rel:"noopener noreferrer"}},[r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("Next, let’s look at some information your CGI program can automatically derive.")]),e._v(" "),r("p",[e._v("接下来，让我们看看您的 CGI 程序可以自动获取的一些信息。")]),e._v(" "),r("h2",{attrs:{id:"request-creation-time"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#request-creation-time"}},[e._v("#")]),e._v(" Request creation time")]),e._v(" "),r("p",[e._v("details.time = int(time()) ## Current epoch (Unix) time")]),e._v(" "),r("h2",{attrs:{id:"request-expiration-time"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#request-expiration-time"}},[e._v("#")]),e._v(" Request expiration time")]),e._v(" "),r("p",[e._v("details.expires = int(time()) + 60 * 10  ## 10 minutes from now")]),e._v(" "),r("h2",{attrs:{id:"paymentdetails-paymentdetails-is-complete-serialize-it-and-store-it-in-paymentrequest-paymentrequest"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#paymentdetails-paymentdetails-is-complete-serialize-it-and-store-it-in-paymentrequest-paymentrequest"}},[e._v("#")]),e._v(" [PaymentDetails][paymentdetails] is complete; serialize it and store it in [PaymentRequest][paymentrequest]")]),e._v(" "),r("p",[e._v("request.serialized_payment_details = details.SerializeToString()")]),e._v(" "),r("h2",{attrs:{id:"serialized-certificate-chain-certificate-chain"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#serialized-certificate-chain-certificate-chain"}},[e._v("#")]),e._v(" Serialized [certificate chain][certificate chain]")]),e._v(" "),r("p",[e._v("request.pki_data = x509.SerializeToString()")]),e._v(" "),r("h2",{attrs:{id:"initialize-signature-field-so-we-can-sign-the-full-paymentrequest-paymentrequest"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#initialize-signature-field-so-we-can-sign-the-full-paymentrequest-paymentrequest"}},[e._v("#")]),e._v(" Initialize signature field so we can sign the full [PaymentRequest][paymentrequest]")]),e._v(" "),r("p",[e._v('request.signature = ""')]),e._v(" "),r("h2",{attrs:{id:"sign-paymentrequest-paymentrequest"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#sign-paymentrequest-paymentrequest"}},[e._v("#")]),e._v(" Sign [PaymentRequest][paymentrequest]")]),e._v(" "),r("p",[e._v('request.signature = sign(private_key, request.SerializeToString(), "sha256")')]),e._v(" "),r("p",[e._v("Each line is described below.")]),e._v(" "),r("p",[e._v("每一行都在下面描述。")]),e._v(" "),r("p",[e._v("details.time = int(time()) ## Current epoch (Unix) time")]),e._v(" "),r("p",[r("code",[e._v("time")]),e._v(": (required) "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentrequest",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentRequests"),r("OutboundLink")],1),e._v(" must indicate when they were created in number of seconds elapsed since 1970-01-01T00:00 UTC ("),r("a",{attrs:{href:"https://en.wikipedia.org/wiki/Unix_time",target:"_blank",rel:"noopener noreferrer"}},[e._v("Unix epoch time"),r("OutboundLink")],1),e._v(" format).")]),e._v(" "),r("p",[e._v("PaymentRequests 必须指出它们是在1970-01-01T00:00 UTC (Unix epoch time format)以秒为单位创建的。")]),e._v(" "),r("p",[e._v("details.expires = int(time()) + 60 * 10  ## 10 minutes from now")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-pp-expires",target:"_blank",rel:"noopener noreferrer"}},[e._v("“expires”"),r("OutboundLink")],1),e._v(": (optional) the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentrequest",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentRequest"),r("OutboundLink")],1),e._v(" may also set an "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-pp-expires",target:"_blank",rel:"noopener noreferrer"}},[e._v("“expires”"),r("OutboundLink")],1),e._v(" time after which they’re no longer valid. You probably want to give receivers the ability to configure the expiration time delta; here we used the reasonable choice of 10 minutes. If this request is tied to an order total based on a "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-fiat",target:"_blank",rel:"noopener noreferrer"}},[e._v("fiat"),r("OutboundLink")],1),e._v("-to-satoshis exchange rate, you probably want to base this on a delta from the time you got the exchange rate.")]),e._v(" "),r("p",[e._v("“ expires” : (可选) PaymentRequest 还可以设置一个“ expires”时间，在此之后它们将不再有效。您可能希望让接收者能够配置过期时间差; 这里我们使用了10分钟的合理选择。如果此请求与基于菲亚特对萨托希斯汇率的订单总额相关联，那么您可能希望基于从获得汇率时起的增量。")]),e._v(" "),r("p",[e._v("request.serialized_payment_details = details.SerializeToString()")]),e._v(" "),r("p",[r("code",[e._v("serialized_payment_details")]),e._v(": (required) we’ve now set everything we need to create the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentdetails",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentDetails"),r("OutboundLink")],1),e._v(", so we’ll use the SerializeToString function from the "),r("a",{attrs:{href:"https://developers.google.com/protocol-buffers/",target:"_blank",rel:"noopener noreferrer"}},[e._v("protocol buffer"),r("OutboundLink")],1),e._v(" code to store the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentdetails",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentDetails"),r("OutboundLink")],1),e._v(" in the appropriate field of the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentrequest",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentRequest"),r("OutboundLink")],1),e._v(".")]),e._v(" "),r("p",[e._v("Serialized _ payment _ details: (必需的)我们现在已经设置了创建 PaymentDetails 所需的一切，因此我们将使用 protocol buffer 代码中的 SerializeToString 函数将 PaymentDetails 存储在 PaymentRequest 的适当字段中。")]),e._v(" "),r("p",[e._v("request.pki_data = x509.SerializeToString()")]),e._v(" "),r("p",[r("code",[e._v("pki_data")]),e._v(": (required for signed "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentrequest",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentRequests"),r("OutboundLink")],1),e._v(") serialize the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-certificate-chain",target:"_blank",rel:"noopener noreferrer"}},[e._v("certificate chain"),r("OutboundLink")],1),e._v(" "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-pp-pki-data",target:"_blank",rel:"noopener noreferrer"}},[e._v("PKI data"),r("OutboundLink")],1),e._v(" and store it in the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentrequest",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentRequest"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("PKI _ data: (需要签名的 PaymentRequests)序列化证书链 PKI 数据并将其存储在 PaymentRequest 中")]),e._v(" "),r("p",[e._v('request.signature = ""')]),e._v(" "),r("p",[e._v("We’ve filled out everything in the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentrequest",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentRequest"),r("OutboundLink")],1),e._v(" except the signature, but before we sign it, we have to initialize the signature field by setting it to a zero-byte placeholder.")]),e._v(" "),r("p",[e._v("除了签名之外，我们已经填写了 PaymentRequest 中的所有内容，但在签名之前，我们必须将签名字段设置为零字节占位符，以初始化签名字段。")]),e._v(" "),r("p",[e._v('request.signature = sign(private_key, request.SerializeToString(), "sha256")')]),e._v(" "),r("p",[r("code",[e._v("signature")]),e._v(": (required for signed "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentrequest",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentRequests"),r("OutboundLink")],1),e._v(") now we make the "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-ssl-signature",target:"_blank",rel:"noopener noreferrer"}},[e._v("signature"),r("OutboundLink")],1),e._v(" by signing the completed and serialized "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentrequest",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentRequest"),r("OutboundLink")],1),e._v(". We’ll use the private key we stored in memory in the configuration section and the same hashing formula we specified in "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-pp-pki-type",target:"_blank",rel:"noopener noreferrer"}},[e._v("“pki_type”"),r("OutboundLink")],1),e._v(" (sha256 in this case)")]),e._v(" "),r("p",[e._v("Signature: (签名的 PaymentRequests 需要)现在我们通过签名已完成的序列化 PaymentRequest 来签名。我们将使用配置节中存储在内存中的私钥和在“ pki _ type”中指定的相同哈希公式(在本例中为 sha256)")]),e._v(" "),r("h4",{attrs:{id:"output-code-输出代码"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#output-code-输出代码"}},[e._v("#")]),e._v(" Output Code 输出代码"),r("a",{attrs:{href:"https://developer.bitcoin.org/examples/payment_processing.html#output-code",title:"Permalink to this headline",target:"_blank",rel:"noopener noreferrer"}},[r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("Now that we have "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentrequest",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentRequest"),r("OutboundLink")],1),e._v(" all filled out, we can serialize it and send it along with the HTTP headers, as shown in the code below.")]),e._v(" "),r("p",[e._v("现在我们已经完成了 PaymentRequest，我们可以对它进行序列化，并将其与 HTTP 头一起发送，如下面的代码所示。")]),e._v(" "),r("p",[e._v('print "Content-Type: application/bitcoin-[paymentrequest][paymentrequest]"\nprint "Content-Transfer-Encoding: binary"\nprint ""')]),e._v(" "),r("p",[e._v("(Required) "),r("a",{attrs:{href:"https://github.com/bitcoin/bips/blob/master/bip-0071.mediawiki",target:"_blank",rel:"noopener noreferrer"}},[e._v("BIP71"),r("OutboundLink")],1),e._v(" defines the content types for "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentrequest",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentRequests"),r("OutboundLink")],1),e._v(", Payments, and PaymentACKs.")]),e._v(" "),r("p",[e._v("(必需的) BIP71定义了 PaymentRequests、 PaymentACKs 和 PaymentACKs 的内容类型。")]),e._v(" "),r("p",[e._v("file.write(stdout, request.SerializeToString())")]),e._v(" "),r("p",[r("code",[e._v("request")]),e._v(": (required) now, to finish, we just dump out the serialized "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentrequest",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentRequest"),r("OutboundLink")],1),e._v(" (which contains the serialized "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentdetails",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentDetails"),r("OutboundLink")],1),e._v("). The serialized data is in binary, so we can’t use Python’s print() because it would add an extraneous newline.")]),e._v(" "),r("p",[e._v("Request: (必需的)现在，为了完成这个任务，我们只需要转储序列化的 PaymentRequest (它包含序列化的 PaymentDetails)。序列化的数据是二进制的，因此我们不能使用 Python 的 print () ，因为它会添加一个无关的换行符。")]),e._v(" "),r("p",[e._v("The following screenshot shows how the authenticated "),r("a",{attrs:{href:"https://developer.bitcoin.org/terms.html#term-paymentdetails",target:"_blank",rel:"noopener noreferrer"}},[e._v("PaymentDetails"),r("OutboundLink")],1),e._v(" created by the program above appears in the GUI from Bitcoin Core 0.9.")]),e._v(" "),r("p",[e._v("下面的屏幕截图显示了上面程序创建的经过验证的 PaymentDetails 是如何出现在来自比特币核心0.9的 GUI 中的。")]),e._v(" "),r("p",[r("img",{staticClass:"lazy",attrs:{alt:"Bitcoin Core Showing Validated Payment Request","data-src":"https://developer.bitcoin.org/_images/en-btcc-payment-request.png",loading:"lazy"}})]),e._v(" "),r("p",[e._v("Bitcoin Core Showing Validated Payment Request"),r("a",{attrs:{href:"https://developer.bitcoin.org/examples/payment_processing.html#id3",title:"Permalink to this image",target:"_blank",rel:"noopener noreferrer"}},[r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("比特币核心显示验证支付请求")])])}),[],!1,null,null,null);t.default=o.exports}}]);