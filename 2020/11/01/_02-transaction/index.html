<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>指南 - Transactions 交易 | 重粒子空间</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Code&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@300;400;500;700&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;400;700&amp;display=swap">
    <link rel="shortcut icon" href="/favicon.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
    <script data-ad-client="ca-pub-2028497727822047" async="true" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <link rel="alternate" type="application/rss+xml" href="https://lilong.net/rss.xml" title="重粒子空间 RSS Feed">
    <meta name="description" content="交易允许用户使用 satoshis。每笔交易都由若干部分组成，既可以进行简单的直接支付，也可以进行复杂的交易。">
    <meta property="article:published_time" content="2020-11-01T02:00:00.000Z">
    <meta property="article:modified_time" content="2020-11-11T04:57:04.000Z">
    <meta property="og:site_name" content="重粒子空间">
    <meta property="og:title" content="指南 - Transactions 交易">
    <meta property="og:description" content="交易允许用户使用 satoshis。每笔交易都由若干部分组成，既可以进行简单的直接支付，也可以进行复杂的交易。">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/2020/11/01/_02-transaction/">
    <meta name="twitter:title" content="指南 - Transactions 交易">
    <meta name="twitter:description" content="交易允许用户使用 satoshis。每笔交易都由若干部分组成，既可以进行简单的直接支付，也可以进行复杂的交易。">
    <meta name="twitter:url" content="/2020/11/01/_02-transaction/">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="比特币, 翻译, 比特币开发指南">
    <meta property="article:tag" content="比特币">
    <meta name="keywords" content="李龙,李龍,baryon,bitcoin,比特币,BSV">
    <meta name="author" content="LI Long">
    
    <link rel="preload" href="/assets/css/0.styles.a7e336af.css" as="style"><link rel="preload" href="/assets/js/app.abf5d3ec.js" as="script"><link rel="preload" href="/assets/js/8.ce1c8cc9.js" as="script"><link rel="preload" href="/assets/js/3.414e57ad.js" as="script"><link rel="preload" href="/assets/js/41.fb9be79b.js" as="script"><link rel="prefetch" href="/assets/js/10.3c652f80.js"><link rel="prefetch" href="/assets/js/11.3031be9d.js"><link rel="prefetch" href="/assets/js/12.f36c79bc.js"><link rel="prefetch" href="/assets/js/13.f2b3627c.js"><link rel="prefetch" href="/assets/js/14.30835e3c.js"><link rel="prefetch" href="/assets/js/15.30714548.js"><link rel="prefetch" href="/assets/js/16.d18f6acc.js"><link rel="prefetch" href="/assets/js/17.37713c96.js"><link rel="prefetch" href="/assets/js/18.0456b1fb.js"><link rel="prefetch" href="/assets/js/19.df061aac.js"><link rel="prefetch" href="/assets/js/20.b671335a.js"><link rel="prefetch" href="/assets/js/21.d39d13fd.js"><link rel="prefetch" href="/assets/js/22.22289641.js"><link rel="prefetch" href="/assets/js/23.9682cf79.js"><link rel="prefetch" href="/assets/js/24.b56b4a09.js"><link rel="prefetch" href="/assets/js/25.e10fe55e.js"><link rel="prefetch" href="/assets/js/26.7960b5af.js"><link rel="prefetch" href="/assets/js/27.c18b8ae0.js"><link rel="prefetch" href="/assets/js/28.13d07b15.js"><link rel="prefetch" href="/assets/js/29.e7e365f1.js"><link rel="prefetch" href="/assets/js/30.e2b7212a.js"><link rel="prefetch" href="/assets/js/31.0a61aa61.js"><link rel="prefetch" href="/assets/js/32.399fd60a.js"><link rel="prefetch" href="/assets/js/33.102e2538.js"><link rel="prefetch" href="/assets/js/34.a2a0eb8a.js"><link rel="prefetch" href="/assets/js/35.fd54c5ac.js"><link rel="prefetch" href="/assets/js/36.7824120d.js"><link rel="prefetch" href="/assets/js/37.0fd00712.js"><link rel="prefetch" href="/assets/js/38.5a9b40ff.js"><link rel="prefetch" href="/assets/js/39.64725c25.js"><link rel="prefetch" href="/assets/js/4.5d973e8f.js"><link rel="prefetch" href="/assets/js/40.086e3669.js"><link rel="prefetch" href="/assets/js/42.2ad9a948.js"><link rel="prefetch" href="/assets/js/43.99993d3a.js"><link rel="prefetch" href="/assets/js/44.42442c0d.js"><link rel="prefetch" href="/assets/js/45.b0dc0368.js"><link rel="prefetch" href="/assets/js/46.3e03bbf4.js"><link rel="prefetch" href="/assets/js/47.cef55138.js"><link rel="prefetch" href="/assets/js/48.bfadcecc.js"><link rel="prefetch" href="/assets/js/49.da0ca54b.js"><link rel="prefetch" href="/assets/js/5.a325b366.js"><link rel="prefetch" href="/assets/js/50.e2220d6e.js"><link rel="prefetch" href="/assets/js/51.39a541e6.js"><link rel="prefetch" href="/assets/js/52.b0cc67f4.js"><link rel="prefetch" href="/assets/js/53.0ad26773.js"><link rel="prefetch" href="/assets/js/54.4c3c30c6.js"><link rel="prefetch" href="/assets/js/55.6f14161b.js"><link rel="prefetch" href="/assets/js/56.ece3c07b.js"><link rel="prefetch" href="/assets/js/57.9efa525e.js"><link rel="prefetch" href="/assets/js/58.0b439759.js"><link rel="prefetch" href="/assets/js/59.8dc823c7.js"><link rel="prefetch" href="/assets/js/6.307deff6.js"><link rel="prefetch" href="/assets/js/60.15e33e41.js"><link rel="prefetch" href="/assets/js/61.b136f576.js"><link rel="prefetch" href="/assets/js/62.f4d9c125.js"><link rel="prefetch" href="/assets/js/7.75ec5eb7.js"><link rel="prefetch" href="/assets/js/9.3cace592.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.851a26a5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a7e336af.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">重粒子空间 </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/about/" class="nav-link">关于</a></li><li class="nav-item"><a href="/tag/" class="nav-link">标签</a></li><li class="nav-item"><a href="/tag/比特币开发指南/" class="nav-link">比特币开发指南</a></li><li class="nav-item"><a href="/tag/sCrypt/" class="nav-link">打开sCrypt的盒子</a></li><li class="nav-item"><a href="https://lilong.net/MasterBitcoinSV/" target="_blank" rel="noopener noreferrer" class="nav-link external">精通比特币SV</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <a href="/rss.xml" class="feed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">重粒子空间 </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/about/" class="nav-link">关于</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">标签</a></li><li class="mobile-nav-item"><a href="/tag/比特币开发指南/" class="nav-link">比特币开发指南</a></li><li class="mobile-nav-item"><a href="/tag/sCrypt/" class="nav-link">打开sCrypt的盒子</a></li><li class="mobile-nav-item"><a href="https://lilong.net/MasterBitcoinSV/" target="_blank" rel="noopener noreferrer" class="nav-link external">精通比特币SV</a></li> <li class="mobile-nav-item"><a href="/rss.xml" class="feed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        指南 - Transactions 交易
      </h1> <div class="post-meta"><!----> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2020-11-01 02:00">
      2020-11-01 2:00 AM
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-42ccfcd5><a href="/tag/比特币" data-v-42ccfcd5><span data-v-42ccfcd5>比特币</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/翻译" data-v-42ccfcd5><span data-v-42ccfcd5>翻译</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/比特币开发指南" data-v-42ccfcd5><span data-v-42ccfcd5>比特币开发指南</span></a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><p>::: info</p> <p>翻译自<a href="https://developer.bitcoin.org/devguide/transactions.html#transactions" target="_blank" rel="noopener noreferrer">Transactions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
内容在整理，准确性请自己确认</p> <p>:::</p> <h1 id="transactions-交易"><a href="#transactions-交易" class="header-anchor">#</a> Transactions 交易</h1> <p>Transactions let users spend satoshis. Each transaction is constructed out of several parts which enable both simple direct payments and complex transactions.</p> <p>交易允许用户使用 satoshis。每笔交易都由若干部分组成，既可以进行简单的直接支付，也可以进行复杂的交易。</p> <h2 id="introduction-引言"><a href="#introduction-引言" class="header-anchor">#</a> Introduction 引言</h2> <p>This section will describe each part and demonstrate how to use them together to build complete transactions.</p> <p>本节将描述每个部分，并演示如何一起使用它们来构建完整的交易。</p> <p>To keep things simple, this section pretends coinbase transactions do not exist. Coinbase transactions can only be created by Bitcoin miners and they’re an exception to many of the rules listed below. Instead of pointing out the coinbase exception to each rule, we invite you to read about coinbase transactions in the block chain section of this guide.</p> <p>为了简单起见，本节假装 coinbase 交易不存在。Coinbase 交易只能由比特币矿工创建，它们是下面列出的许多规则的例外。与其指出每个规则的 coinbase 异常，我们邀请您阅读本指南区块链部分的 coinbase 交易。</p> <p><img alt="The Parts Of A Transaction" data-src="https://developer.bitcoin.org/_images/en-tx-overview.svg" loading="lazy" class="lazy"></p> <h2 id="交易的构造"><a href="#交易的构造" class="header-anchor">#</a> 交易的构造</h2> <p>The figure above shows the main parts of a Bitcoin transaction. Each transaction has at least one input and one output. Each <a href="https://developer.bitcoin.org/glossary.html#term-Input" target="_blank" rel="noopener noreferrer">input<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> spends the satoshis paid to a previous output. Each <a href="https://developer.bitcoin.org/glossary.html#term-Output" target="_blank" rel="noopener noreferrer">output<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> then waits as an Unspent Transaction Output (UTXO) until a later input spends it. When your Bitcoin wallet tells you that you have a 10,000 satoshi balance, it really means that you have 10,000 satoshis waiting in one or more UTXOs.</p> <p>上图显示了比特币交易的主要部分。每个交易至少有一个输入和一个输出。每个输入花费 satoshis 支付以前的输出。然后，每个输出作为未使用的交易输出(UTXO)等待，直到稍后的输入使用它。当你的比特币钱包告诉你你有10,000个 satoshi 余额时，这实际上意味着你有10,000个 satoshis 在一个或多个 UTXOs 中。</p> <p>Each transaction is prefixed by a four-byte <a href="https://developer.bitcoin.org/terms.html#term-transaction-version-number" target="_blank" rel="noopener noreferrer">transaction version number<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> which tells Bitcoin peers and miners which set of rules to use to validate it. This lets developers create new rules for future transactions without invalidating previous transactions.</p> <p>每个交易都有一个四字节的交易版本号作为前缀，这个版本号告诉比特币节点和矿工使用哪组规则来验证它。这使得开发人员可以为未来的交易创建新的规则，而不会使以前的交易无效。</p> <p><img alt="Spending An Output" data-src="https://developer.bitcoin.org/_images/en-tx-overview-spending.svg" loading="lazy" class="lazy"></p> <h2 id="花费一个输出"><a href="#花费一个输出" class="header-anchor">#</a> 花费一个输出</h2> <p>An output has an implied index number based on its location in the transaction—the index of the first output is zero. The output also has an amount in satoshis which it pays to a conditional pubkey script. Anyone who can satisfy the conditions of that pubkey script can spend up to the amount of satoshis paid to it.</p> <p>输出具有基于其在交易中的位置的隐含索引号ー第一个输出的索引为零。输出还有一个 satoshis 数量，它支付给一个有解锁条件的 pubkey 脚本。任何人只要能满足这个公共脚本的条件，就可以花费其中的 satoshis 。</p> <p>An input uses a transaction identifier (txid) and an <a href="https://developer.bitcoin.org/terms.html#term-output-index" target="_blank" rel="noopener noreferrer">output index<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> number (often called “vout” for output vector) to identify a particular output to be spent. It also has a signature script which allows it to provide data parameters that satisfy the conditionals in the pubkey script. (The sequence number and locktime are related and will be covered together in a later subsection.)</p> <p>输入使用交易标识符(txid)和输出索引号(输出向量通常称为“ vout”)来标识要使用的特定输出。它还有一个签名脚本，允许它提供满足 pubkey 脚本条件的数据参数。(序列号和锁定时间是相关的，将在以后的小节中一起讨论。)</p> <p>The figures below help illustrate how these features are used by showing the workflow Alice uses to send Bob a transaction and which Bob later uses to spend that transaction. Both Alice and Bob will use the most common form of the standard Pay-To-Public-Key-Hash (P2PKH) transaction type. <a href="https://developer.bitcoin.org/glossary.html#term-P2PKH-address" target="_blank" rel="noopener noreferrer">P2PKH<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> lets Alice spend satoshis to a typical Bitcoin address, and then lets Bob further spend those satoshis using a simple cryptographic <a href="https://developer.bitcoin.org/terms.html#term-key-pair" target="_blank" rel="noopener noreferrer">key pair<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>下面的图表通过显示 Alice 用于向 Bob 发送交易的工作流以及 Bob 稍后用于支出该交易的工作流，帮助说明如何使用这些特性。Alice 和 Bob 都将使用标准的 Pay-To-Public-Key-Hash (P2PKH)交易类型的最常见形式。2pkh 让 Alice 把 satoshis 花到一个典型的比特币地址，然后让 Bob 用一个简单的密钥对继续花掉这些 satoshis。</p> <p><img alt="Creating A P2PKH Public Key Hash To Receive Payment" data-src="https://developer.bitcoin.org/_images/en-creating-p2pkh-output.svg" loading="lazy" class="lazy"></p> <h3 id="创建-p2pkh-公钥哈希以接收付款"><a href="#创建-p2pkh-公钥哈希以接收付款" class="header-anchor">#</a> 创建 P2PKH 公钥哈希以接收付款</h3> <p>Bob must first generate a private/public <a href="https://developer.bitcoin.org/terms.html#term-key-pair" target="_blank" rel="noopener noreferrer">key pair<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> before Alice can create the first transaction. Bitcoin uses the Elliptic Curve Digital Signature Algorithm (<a href="https://en.wikipedia.org/wiki/Elliptic_Curve_DSA" target="_blank" rel="noopener noreferrer">ECDSA<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) with the <a href="http://www.secg.org/sec2-v2.pdf" target="_blank" rel="noopener noreferrer">secp256k1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> curve; <a href="http://www.secg.org/sec2-v2.pdf" target="_blank" rel="noopener noreferrer">secp256k1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://developer.bitcoin.org/glossary.html#term-Private-key" target="_blank" rel="noopener noreferrer">private keys<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> are 256 bits of random data. A copy of that data is deterministically transformed into an <a href="http://www.secg.org/sec2-v2.pdf" target="_blank" rel="noopener noreferrer">secp256k1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://developer.bitcoin.org/glossary.html#term-Public-key" target="_blank" rel="noopener noreferrer">public key<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Because the transformation can be reliably repeated later, the public key does not need to be stored.</p> <p>在 Alice 创建第一个交易之前，Bob 必须首先生成一个私有/公共密钥对。比特币使用 secp256k1曲线的 ECDSA 椭圆曲线数字签名算法; secp256k1私钥是256位的随机数据。该数据的副本确定地转换为 secp256k1公钥。因为稍后可以可靠地重复转换，所以不需要存储公钥。</p> <p>The public key (pubkey) is then cryptographically hashed. This pubkey hash can also be reliably repeated later, so it also does not need to be stored. The hash shortens and obfuscates the public key, making manual transcription easier and providing security against unanticipated problems which might allow reconstruction of private keys from public key data at some later point.</p> <p>然后对公钥(pubkey)进行加密哈希运算。这个 pubkey 哈希在以后也可以可靠地重复，所以它也不需要存储。哈希会缩短和模糊公钥，使手工转录更加容易，并且提供了安全性，以防止可能在以后某个时间点从公钥数据重构私钥的意外问题。</p> <p>Bob provides the pubkey hash to Alice. Pubkey hashes are almost always sent encoded as Bitcoin <a href="https://developer.bitcoin.org/glossary.html#term-Address" target="_blank" rel="noopener noreferrer">addresses<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, which are base58-encoded strings containing an address version number, the hash, and an error-detection checksum to catch typos. The address can be transmitted through any medium, including one-way mediums which prevent the spender from communicating with the receiver, and it can be further encoded into another format, such as a QR code containing a <a href="https://developer.bitcoin.org/terms.html#term-bitcoin-uri" target="_blank" rel="noopener noreferrer">“bitcoin:” URI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Bob 向 Alice 提供 pubkey 哈希。Pubkey 哈希几乎总是以比特币地址的编码方式发送，比特币地址是基于 base58编码的字符串，其中包含地址版本号、哈希和一个错误检测校验和，用于捕获输入错误。地址可以通过任何媒介传输，包括阻止挥霍者与接收者通信的单向媒介，还可以进一步编码成另一种格式，比如包含“ bitcoin: ” URI 的二维码。</p> <p>Once Alice has the address and decodes it back into a standard hash, she can create the first transaction. She creates a standard P2PKH transaction output containing instructions which allow anyone to spend that output if they can prove they control the private key corresponding to Bob’s hashed public key. These instructions are called the <a href="https://developer.bitcoin.org/glossary.html#term-Pubkey-script" target="_blank" rel="noopener noreferrer">pubkey script<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> or scriptPubKey.</p> <p>一旦 Alice 获得了地址并将其解码回标准哈希，她就可以创建第一个交易。她创建了一个标准的 P2PKH 交易输出，其中包含了一些指令，这些指令允许任何人使用这些输出，只要他们能够证明自己控制了与 Bob 哈希公钥对应的私钥。这些指令称为 pubkey 脚本或 scriptPubKey。</p> <p>Alice broadcasts the transaction and it is added to the block chain. The <a href="https://developer.bitcoin.org/devguide/p2p_network.html" target="_blank" rel="noopener noreferrer">network<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> categorizes it as an Unspent Transaction Output (UTXO), and Bob’s wallet software displays it as a spendable balance.</p> <p>Alice 广播交易并将其添加到块链中。网络将其归类为未用交易输出(UTXO) ，Bob 的钱包软件将其显示为可消费余额。</p> <p>When, some time later, Bob decides to spend the UTXO, he must create an input which references the transaction Alice created by its hash, called a Transaction Identifier (txid), and the specific output she used by its index number (<a href="https://developer.bitcoin.org/terms.html#term-output-index" target="_blank" rel="noopener noreferrer">output index<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>). He must then create a <a href="https://developer.bitcoin.org/glossary.html#term-Signature-script" target="_blank" rel="noopener noreferrer">signature script<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>—a collection of data parameters which satisfy the conditions Alice placed in the previous output’s pubkey script. Signature scripts are also called scriptSigs.</p> <p>一段时间后，当 Bob 决定使用 UTXO 时，他必须创建一个输入，该输入引用由其 hash 创建的交易 Alice (称为 Transaction Identifier (txid)) ，以及由其索引号(输出索引)使用的特定输出。然后，他必须创建一个签名脚本ーー一组数据参数，满足 Alice 在前一个输出的 pubkey 脚本中设置的条件。签名脚本也称为 scriptSigs。</p> <p>Pubkey scripts and signature scripts combine <a href="http://www.secg.org/sec2-v2.pdf" target="_blank" rel="noopener noreferrer">secp256k1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> pubkeys and signatures with conditional logic, creating a programmable authorization mechanism.</p> <p>Pubkey 脚本和签名脚本将 secp256k1 pubkeys 和签名与条件逻辑结合起来，创建了一个可编程的授权机制。</p> <p><img alt="Unlocking A P2PKH Output For Spending" data-src="https://developer.bitcoin.org/_images/en-unlocking-p2pkh-output.svg" loading="lazy" class="lazy"></p> <h3 id="解锁一个-p2pkh-输出用于支出"><a href="#解锁一个-p2pkh-输出用于支出" class="header-anchor">#</a> 解锁一个 P2PKH 输出用于支出</h3> <p>For a P2PKH-style output, Bob’s signature script will contain the following two pieces of data:</p> <p>对于 p2pkh 风格的输出，Bob 的签名脚本将包含以下两部分数据:</p> <ol><li><p>His full (unhashed) public key, so the pubkey script can check that it hashes to the same value as the pubkey hash provided by Alice.</p> <p>他有完整(反向)公钥，因此 pubkey 脚本可以检查它是否哈希到与 Alice 提供的 pubkey 哈希相同的值。</p></li> <li><p>An <a href="http://www.secg.org/sec2-v2.pdf" target="_blank" rel="noopener noreferrer">secp256k1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://developer.bitcoin.org/glossary.html#term-Signature" target="_blank" rel="noopener noreferrer">signature<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> made by using the <a href="https://en.wikipedia.org/wiki/Elliptic_Curve_DSA" target="_blank" rel="noopener noreferrer">ECDSA<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> cryptographic formula to combine certain transaction data (described below) with Bob’s private key. This lets the pubkey script verify that Bob owns the private key which created the public key.</p> <p>通过使用 ECDSA 加密公式将某些交易数据(如下所述)与 Bob 的私钥结合而生成的 secp256k1签名。这使得 pubkey 脚本可以验证 Bob 是否拥有创建公钥的私钥。</p></li></ol> <p>Bob’s <a href="http://www.secg.org/sec2-v2.pdf" target="_blank" rel="noopener noreferrer">secp256k1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> signature doesn’t just prove Bob controls his private key; it also makes the non-signature-script parts of his transaction tamper-proof so Bob can safely broadcast them over the <a href="https://developer.bitcoin.org/devguide/p2p_network.html" target="_blank" rel="noopener noreferrer">peer-to-peer network<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Bob 的 secp256k1签名不仅证明 Bob 控制了他的私钥，而且还使他的交易的非签名脚本部分成为防篡改的，这样 Bob 就可以通过 p2p 网络安全地广播它们。</p> <p><img alt="Some Things Signed When Spending An Output" data-src="https://developer.bitcoin.org/_images/en-signing-output-to-spend.svg" loading="lazy" class="lazy"></p> <h3 id="花费支出是签名的一些东西"><a href="#花费支出是签名的一些东西" class="header-anchor">#</a> 花费支出是签名的一些东西</h3> <p>As illustrated in the figure above, the data Bob signs includes the txid and <a href="https://developer.bitcoin.org/terms.html#term-output-index" target="_blank" rel="noopener noreferrer">output index<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> of the previous transaction, the previous output’s pubkey script, the pubkey script Bob creates which will let the next recipient spend this transaction’s output, and the amount of satoshis to spend to the next recipient. In essence, the entire transaction is signed except for any signature scripts, which hold the full public keys and <a href="http://www.secg.org/sec2-v2.pdf" target="_blank" rel="noopener noreferrer">secp256k1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> signatures.</p> <p>如上图所示，Bob 签名的数据包括前一个交易的 txid 和输出索引、前一个输出的 pubkey 脚本、 Bob 创建的允许下一个接收者使用该交易输出的 pubkey 脚本，以及用于下一个接收者的 satoshis 数量。实际上，除了包含完整公钥和 secp256k1签名的签名脚本之外，整个交易都是签名的。</p> <p>After putting his signature and public key in the signature script, Bob broadcasts the transaction to Bitcoin miners through the <a href="https://developer.bitcoin.org/devguide/p2p_network.html" target="_blank" rel="noopener noreferrer">peer-to-peer network<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Each peer and miner independently validates the transaction before broadcasting it further or attempting to include it in a new block of transactions.</p> <p>在签名脚本中放入自己的签名和公钥之后，Bob 通过对等网络向比特币矿工广播交易。在进一步广播交易或试图将其包含到新的交易块中之前，每个对等方和 miner 都独立地验证交易。</p> <h2 id="p2pkh-script-validation-p2pkh-脚本验证"><a href="#p2pkh-script-validation-p2pkh-脚本验证" class="header-anchor">#</a> P2PKH Script Validation P2PKH 脚本验证</h2> <p>The validation procedure requires evaluation of the signature script and pubkey script. In a P2PKH output, the pubkey script is:</p> <p>验证过程需要对签名脚本和 pubkey 脚本进行评估。在 P2PKH 输出中，pubkey 脚本是:</p> <div class="language- extra-class"><pre class="language-text"><code>OP_DUP OP_HASH160 &lt;PubkeyHash&gt; OP_EQUALVERIFY OP_CHECKSIG
</code></pre></div><p>The spender’s signature script is evaluated and prefixed to the beginning of the script. In a P2PKH transaction, the signature script contains an <a href="http://www.secg.org/sec2-v2.pdf" target="_blank" rel="noopener noreferrer">secp256k1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> signature (sig) and full public key (pubkey), creating the following concatenation:</p> <p>花钱的人的签名脚本是评估和前缀的脚本的开始。在 P2PKH 交易中，签名脚本包含 secp256k1签名(sig)和完整公钥(pubkey) ，创建以下连接:</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;Sig&gt; &lt;PubKey&gt; OP_DUP OP_HASH160 &lt;PubkeyHash&gt; OP_EQUALVERIFY OP_CHECKSIG
</code></pre></div><p>The script language is a <a href="https://en.wikipedia.org/wiki/Forth_%28programming_language%29" target="_blank" rel="noopener noreferrer">Forth-like<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> stack-based language deliberately designed to be stateless and not Turing complete. Statelessness ensures that once a transaction is added to the block chain, there is no condition which renders it permanently unspendable. Turing-incompleteness (specifically, a lack of loops or gotos) makes the script language less flexible and more predictable, greatly simplifying the security model.</p> <p>脚本语言是一种类似于 forth 的基于堆栈的语言，故意设计成无状态的，而不是图灵完成的。无状态状态确保了一旦将交易添加到块链中，就不存在使其永久不可消费的条件。图灵不完整(具体地说，缺少循环或 goto)使脚本语言更不灵活，更可预测，大大简化了安全模型。</p> <p>To test whether the transaction is valid, signature script and pubkey script operations are executed one item at a time, starting with Bob’s signature script and continuing to the end of Alice’s pubkey script. The figure below shows the evaluation of a standard P2PKH pubkey script; below the figure is a description of the process.</p> <p>为了测试交易是否有效，签名脚本和 pubkey 脚本操作一次执行一个项目，从 Bob 的签名脚本开始，一直到 Alice 的 pubkey 脚本结束。下图显示了对标准 P2PKH pubkey 脚本的评价; 下图是对流程的描述。</p> <p><img alt="P2PKH Stack Evaluation" data-src="https://developer.bitcoin.org/_images/en-p2pkh-stack.svg" loading="lazy" class="lazy"></p> <h3 id="p2pkh-堆栈计算"><a href="#p2pkh-堆栈计算" class="header-anchor">#</a> P2PKH 堆栈计算</h3> <ul><li><p>The signature (from Bob’s signature script) is added (pushed) to an empty stack. Because it’s just data, nothing is done except adding it to the stack. The public key (also from the signature script) is pushed on top of the signature.</p> <p>签名(来自 Bob 的签名脚本)被添加(推送)到一个空栈中。因为它只是数据，除了将其添加到堆栈之外，什么也不做。公钥(也来自签名脚本)被推到签名的顶部。</p></li> <li><p>From Alice’s pubkey script, the <a href="https://developer.bitcoin.org/terms.html#term-op-dup" target="_blank" rel="noopener noreferrer"><code>op_dup</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> operation is executed. <a href="https://developer.bitcoin.org/terms.html#term-op-dup" target="_blank" rel="noopener noreferrer"><code>op_dup</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> pushes onto the stack a copy of the data currently at the top of it—in this case creating a copy of the public key Bob provided.</p> <p>在 Alice 的 pubkey 脚本中，执行<code>op_dup</code>操作。“<code>op_dup</code>当前位于堆栈顶部的数据的一个副本(在本例中创建 Bob 提供的公钥的一个副本)压入堆栈。</p></li> <li><p>The operation executed next, <a href="https://developer.bitcoin.org/terms.html#term-op-hash160" target="_blank" rel="noopener noreferrer">“OP_HASH160”<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, pushes onto the stack a hash of the data currently on top of it—in this case, Bob’s public key. This creates a hash of Bob’s public key.</p> <p>接下来执行的操作“ OP _ hash160”将当前位于堆栈顶部的数据的哈希(在本例中为 Bob 的公钥)推送到堆栈上。这将创建 Bob 的公钥哈希。</p></li> <li><p>Alice’s pubkey script then pushes the pubkey hash that Bob gave her for the first transaction. At this point, there should be two copies of Bob’s pubkey hash at the top of the stack.</p> <p>Alice 的 pubkey 脚本然后推入 pubkey 哈希，这是 Bob 在第一次交易处理时给她的。此时，在堆栈顶部应该有 Bob 的 pubkey 哈希的两个副本。</p></li> <li><p>Now it gets interesting: Alice’s pubkey script executes <a href="https://developer.bitcoin.org/terms.html#term-op-equalverify" target="_blank" rel="noopener noreferrer"><code>OP_EQUALVERIFY</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. <a href="https://developer.bitcoin.org/terms.html#term-op-equalverify" target="_blank" rel="noopener noreferrer"><code>OP_EQUALVERIFY</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is equivalent to executing <a href="https://developer.bitcoin.org/terms.html#term-op-equal" target="_blank" rel="noopener noreferrer"><code>OP_EQUAL</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> followed by <a href="https://developer.bitcoin.org/terms.html#term-op-verify" target="_blank" rel="noopener noreferrer"><code>OP_VERIFY</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (not shown).</p> <p>现在有趣的是: Alice 的 pubkey 脚本执行<code>OP_EQUALVERIFY</code> ， <code>OP_EQUALVERIFY</code>执行<code>OP_EQUAL</code> ，后面是<code>OP_VERIFY</code>(未显示)。</p> <p><a href="https://developer.bitcoin.org/terms.html#term-op-equal" target="_blank" rel="noopener noreferrer"><code>OP_EQUAL</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (not shown) checks the two values at the top of the stack; in this case, it checks whether the pubkey hash generated from the full public key Bob provided equals the pubkey hash Alice provided when she created transaction #1. <a href="https://developer.bitcoin.org/terms.html#term-op-equal" target="_blank" rel="noopener noreferrer"><code>OP_EQUAL</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> pops (removes from the top of the stack) the two values it compared, and replaces them with the result of that comparison: zero (<em>false</em>) or one (<em>true</em>).</p> <p><code>OP_EQUAL</code>(未显示)检查堆栈顶部的两个值; 在本例中，它检查 Bob 提供的完整公钥所生成的 pubkey 哈希是否等于 Alice 在创建 transaction # 1时提供的 pubkey 哈希。“ O<code>OP_EQUAL</code>ps (从堆栈顶部删除)比较的两个值，并用比较的结果替换它们: 0(false)或1(true)。</p> <p><a href="https://developer.bitcoin.org/terms.html#term-op-verify" target="_blank" rel="noopener noreferrer"><code>OP_VERIFY</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (not shown) checks the value at the top of the stack. If the value is <em>false</em> it immediately terminates evaluation and the transaction validation fails. Otherwise it pops the <em>true</em> value off the stack.</p> <p><code>OP_VERIFY</code>(未显示)检查堆栈顶部的值。如果值为 false，则立即终止计算，交易验证失败。否则，它将从堆栈中弹出真实值。</p></li> <li><p>Finally, Alice’s pubkey script executes <a href="https://developer.bitcoin.org/terms.html#term-op-checksig" target="_blank" rel="noopener noreferrer"><code>OP_CHECKSIG</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, which checks the signature Bob provided against the now-authenticated public key he also provided. If the signature matches the public key and was generated using all of the data required to be signed, <a href="https://developer.bitcoin.org/terms.html#term-op-checksig" target="_blank" rel="noopener noreferrer"><code>OP_CHECKSIG</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> pushes the value <em>true</em> onto the top of the stack.</p> <p>最后，Alice 的 pubkey 脚本执行<code>OP_CHECKSIG</code> ，该脚本检查 Bob 提供的签名是否与他提供的现已认证的公钥相符。如果签名与公钥匹配并使用需要签名的所有数据生成，“ op_checksig”将值 true 推送到堆栈顶部。</p></li></ul> <p>If <em>false</em> is not at the top of the stack after the pubkey script has been evaluated, the transaction is valid (provided there are no other problems with it).</p> <p>如果在计算 pubkey 脚本之后，false 不在堆栈顶部，那么交易是有效的(前提是它没有其他问题)。</p> <h2 id="p2sh-scripts-p2sh-脚本"><a href="#p2sh-scripts-p2sh-脚本" class="header-anchor">#</a> P2SH Scripts P2SH 脚本</h2> <p>Pubkey scripts are created by spenders who have little interest what that script does. Receivers do care about the script conditions and, if they want, they can ask spenders to use a particular pubkey script. Unfortunately, custom pubkey scripts are less convenient than short Bitcoin addresses and there was no standard way to communicate them between programs prior to widespread implementation of the now deprecated <a href="https://github.com/bitcoin/bips/blob/master/bip-0070.mediawiki" target="_blank" rel="noopener noreferrer">BIP70<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>Payment Protocol discussed later.</p> <p>Pubkey 脚本是由那些花钱大手大脚的人创建的，他们对这个脚本的作用不感兴趣。接收者确实关心脚本条件，如果他们愿意，他们可以要求消费者使用一个特定的 pubkey 脚本。不幸的是，自定义 pubkey 脚本不如短比特币地址方便，在现在已经被广泛使用的 BIP70支付协议之前，没有标准的方式在程序之间进行通信。</p> <p>To solve these problems, pay-to-script-hash (<a href="https://developer.bitcoin.org/glossary.html#term-P2SH-address" target="_blank" rel="noopener noreferrer">P2SH<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) transactions were created in 2012 to let a spender create a pubkey script containing a hash of a second script, the <a href="https://developer.bitcoin.org/glossary.html#term-Redeem-script" target="_blank" rel="noopener noreferrer">redeem script<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>为了解决这些问题，在2012年创建了支付脚本哈希(P2SH)交易，让挥霍者创建一个包含第二个脚本哈希(即赎回脚本)的公共密钥脚本。</p> <p>The basic P2SH workflow, illustrated below, looks almost identical to the P2PKH workflow. Bob creates a redeem script with whatever script he wants, hashes the redeem script, and provides the redeem script hash to Alice. Alice creates a P2SH-style output containing Bob’s redeem script hash.</p> <p>基本的 P2SH 工作流，如下图所示，看起来几乎与 P2PKH 工作流完全相同。Bob 用他想要的任何脚本创建一个赎回脚本，对赎回脚本进行哈希，并向 Alice 提供赎回脚本哈希。Alice 创建一个 p2sh 风格的输出，其中包含 Bob 的 redeem 脚本哈希。</p> <p><img alt="Creating A P2SH Redeem Script And Hash" data-src="https://developer.bitcoin.org/_images/en-creating-p2sh-output.svg" loading="lazy" class="lazy"></p> <p>创建 P2SH 赎回脚本和哈希</p> <p>When Bob wants to spend the output, he provides his signature along with the full (serialized) redeem script in the signature script. The <a href="https://developer.bitcoin.org/devguide/p2p_network.html" target="_blank" rel="noopener noreferrer">peer-to-peer network<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ensures the full redeem script hashes to the same value as the script hash Alice put in her output; it then processes the redeem script exactly as it would if it were the primary pubkey script, letting Bob spend the output if the redeem script does not return false.</p> <p>当 Bob 希望使用输出时，他会在签名脚本中提供自己的签名以及完整的(序列化的)赎回脚本。P2p 网络确保完整的赎回脚本哈希值与 Alice 在其输出中放入的脚本哈希值相同; 然后，它会像处理主 pubkey 脚本那样处理赎回脚本，如果赎回脚本没有返回 false，Bob 就可以使用输出。</p> <p><img alt="Unlocking A P2SH Output For Spending" data-src="https://developer.bitcoin.org/_images/en-unlocking-p2sh-output.svg" loading="lazy" class="lazy"></p> <p>Unlocking A P2SH Output For Spending<a href="https://developer.bitcoin.org/devguide/transactions.html#id8" title="Permalink to this image" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>释放 P2SH 支出</p> <p>The hash of the redeem script has the same properties as a pubkey hash—so it can be transformed into the standard Bitcoin address format with only one small change to differentiate it from a standard address. This makes collecting a P2SH-style address as simple as collecting a P2PKH-style address. The hash also obfuscates any public keys in the redeem script, so P2SH scripts are as secure as P2PKH pubkey hashes.</p> <p>赎回脚本的哈希具有与 pubkey 哈希相同的属性，因此只需稍作修改，就可以将其转换为标准的比特币地址格式，以区别于标准地址。这使得收集 p2sh 风格的地址就像收集 p2pkh- 风格的地址一样简单。哈希还模糊了赎回脚本中的任何公钥，因此 P2SH 脚本与 P2PKH pubkey 哈希一样安全。</p> <h2 id="standard-transactions-标准交易"><a href="#standard-transactions-标准交易" class="header-anchor">#</a> Standard Transactions 标准交易</h2> <p>After the discovery of several dangerous bugs in early versions of Bitcoin, a test was added which only accepted transactions from the <a href="https://developer.bitcoin.org/devguide/p2p_network.html" target="_blank" rel="noopener noreferrer">network<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> if their pubkey scripts and signature scripts matched a small set of believed-to-be-safe templates, and if the rest of the transaction didn’t violate another small set of rules enforcing good <a href="https://developer.bitcoin.org/devguide/p2p_network.html" target="_blank" rel="noopener noreferrer">network<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> behavior. This is the <code>IsStandard()</code> test, and transactions which pass it are called standard transactions.</p> <p>在发现早期版本的比特币中存在几个危险的漏洞之后，又增加了一个测试，该测试只接受来自网络的交易，前提是它们的 pubkey 脚本和签名脚本与一小组被认为是安全的模板相匹配，以及交易的其余部分没有违反另一小组强制实施良好网络行为的规则。这是 IsStandard ()测试，通过它的交易称为标准交易。</p> <p>Non-standard transactions—those that fail the test—may be accepted by nodes not using the default Bitcoin Core settings. If they are included in blocks, they will also avoid the IsStandard test and be processed.</p> <p>非标准交易——即那些未能通过测试的交易——可能会被不使用默认比特币核心设置的节点接受。如果它们包含在块中，它们也将避免进行 IsStandard 测试并被处理。</p> <p>Besides making it more difficult for someone to attack Bitcoin for free by broadcasting harmful transactions, the standard transaction test also helps prevent users from creating transactions today that would make adding new transaction features in the future more difficult. For example, as described above, each transaction includes a version number—if users started arbitrarily changing the version number, it would become useless as a tool for introducing backwards-incompatible features.</p> <p>标准的交易测试不仅让人们更难以通过广播有害交易来免费攻击比特币，还有助于防止用户今天创建交易，从而使未来增加新的交易功能更加困难。例如，如上所述，每个交易都包含一个版本号ーー如果用户开始随意更改版本号，那么它作为引入向后不兼容特性的工具将毫无用处。</p> <p>As of Bitcoin Core 0.9, the standard pubkey script types are:</p> <p>在比特币核心0.9中，标准的 pubkey 脚本类型是:</p> <ul><li><p>Pay To Public Key Hash (P2PKH)</p> <p>支付到公开密钥哈希(P2PKH)</p></li> <li><p>Pay To Script Hash (P2SH)</p> <p>支付到脚本哈希(P2SH)</p></li> <li><p>Multisig</p></li> <li><p>Pubkey</p></li> <li><p>Null Data</p> <p>空数据</p></li></ul> <h3 id="pay-to-public-key-hash-p2pkh-支付到公钥哈希-p2pkh"><a href="#pay-to-public-key-hash-p2pkh-支付到公钥哈希-p2pkh" class="header-anchor">#</a> Pay To Public Key Hash (P2PKH) 支付到公钥哈希(P2PKH)</h3> <p>P2PKH is the most common form of pubkey script used to send a transaction to one or multiple Bitcoin addresses.</p> <p>P2PKH 是 pubkey 脚本最常见的形式，用于向一个或多个比特币地址发送交易。</p> <div class="language- extra-class"><pre class="language-text"><code>Pubkey script: OP_DUP OP_HASH160 &lt;PubKeyHash&gt; OP_EQUALVERIFY OP_CHECKSIG
Signature script: &lt;sig&gt; &lt;pubkey&gt;
</code></pre></div><h3 id="pay-to-script-hash-p2sh-支付到脚本哈希-p2sh"><a href="#pay-to-script-hash-p2sh-支付到脚本哈希-p2sh" class="header-anchor">#</a> Pay To Script Hash (P2SH) 支付到脚本哈希(P2SH)</h3> <p>P2SH is used to send a transaction to a script hash. Each of the standard pubkey scripts can be used as a P2SH redeem script, excluding P2SH itself. As of Bitcoin Core 0.9.2, P2SH transactions can contain any valid redeemScript, making the P2SH standard much more flexible and allowing for experimentation with many novel and complex types of transactions. The most common use of P2SH is the standard multisig pubkey script, with the second most common use being the <a href="https://github.com/OpenAssets/open-assets-protocol/blob/master/specification.mediawiki" target="_blank" rel="noopener noreferrer">Open Assets Protocol<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>P2SH 用于将交易发送到脚本哈希。每个标准 pubkey 脚本都可以用作 P2SH 赎回脚本，P2SH 本身除外。由于比特币核心0.9.2，P2SH 交易可以包含任何有效的 redeemScript，使得 P2SH 标准更加灵活，并允许对许多新颖和复杂类型的交易进行实验。P2SH 最常见的用途是标准的 multisig pubkey 脚本，其次是开放资产协议。</p> <p>Another common redeemScript used for P2SH is storing textual data on the blockchain. The first bitcoin transaction ever made included text, and P2SH is a convenient method of storing text on the blockchain as its possible to store up to 1.5kb of text data. An example of storing text on the blockchain using P2SH can be found in this <a href="https://github.com/petertodd/checklocktimeverify-demos/blob/master/lib/python-bitcoinlib/examples/publish-text.py" target="_blank" rel="noopener noreferrer">repository<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>用于 P2SH 的另一个常见的 redeemScript 是在区块链上存储文本数据。第一个比特币交易有史以来包括文本，和 P2SH 是一个方便的方法存储文本的封锁链条，因为它可以存储高达1.5 kb 的文本数据。使用 P2SH 在区块链上存储文本的示例可以在这个存储库中找到。</p> <div class="language- extra-class"><pre class="language-text"><code>Pubkey script: OP_HASH160 &lt;Hash160(redeemScript)&gt; OP_EQUAL
Signature script: &lt;sig&gt; [sig] [sig...] &lt;redeemScript&gt;
</code></pre></div><p>This script combination looks perfectly fine to old nodes as long as the script hash matches the redeem script. However, after the soft fork is activated, new nodes will perform a further verification for the redeem script. They will extract the redeem script from the signature script, decode it, and execute it with the remaining stack items(<code>&lt;sig&gt; [sig] [sig..]part</code>). Therefore, to redeem a P2SH transaction, the spender must provide the valid signature or answer in addition to the correct redeem script.</p> <p>只要脚本哈希符合可赎回脚本，这个脚本组合对于旧节点来说就完全没有问题。但是，在激活软 fork 之后，新节点将对 redemption 脚本执行进一步的验证。他们将从签名脚本中提取赎回脚本，对其进行解码，并用剩余的堆栈项目执行该脚本(<code>&lt;sig&gt; [sig][sig]..]部分</code>)。因此，要赎回 P2SH 交易，除了正确的赎回脚本之外，消费者还必须提供有效的签名或答案。</p> <p>This last step is similar to the verification step in P2PKH or P2Multisig scripts, where the initial part of the signature script(<code>&lt;sig&gt; [sig] [sig..]</code>) acts as the “signature script” in P2PKH/P2Multisig, and the redeem script acts as the “pubkey script”.</p> <p>最后一步类似于 P2PKH 或 P2Multisig 脚本中的验证步骤，其中签名脚本的初始部分(<code>&lt;sig&gt; [sig][sig]..]</code>)作为 P2PKH/P2Multisig 中的“签名脚本” ，赎回脚本作为“公钥脚本”。</p> <h3 id="multisig-多签"><a href="#multisig-多签" class="header-anchor">#</a> Multisig 多签</h3> <p>Although P2SH multisig is now generally used for multisig transactions, this base script can be used to require multiple signatures before a UTXO can be spent.</p> <p>虽然 P2SH multisig 现在通常用于多重信息交易，但是这个基本脚本可以用于在使用 UTXO 之前需要多个签名。</p> <p>In multisig pubkey scripts, called m-of-n, <em>m</em> is the <em>minimum</em> number of signatures which must match a public key; <em>n</em> is the <em>number</em> of public keys being provided. Both <em>m</em> and <em>n</em> should be opcodes <code>OP_1</code> through <code>OP_16</code>, corresponding to the number desired.</p> <p>在称为 m-of-n 的 multisig pubkey 脚本中，m 是必须与公钥匹配的最小签名数; n 是提供的公钥数。M 和 n 都应该是 opcodes OP _ 1到 OP _ 16，对应于所需的数字。</p> <p>Because of an off-by-one error in the original Bitcoin implementation which must be preserved for compatibility, <a href="https://developer.bitcoin.org/terms.html#term-op-checkmultisig" target="_blank" rel="noopener noreferrer">“OP_CHECKMULTISIG”<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> consumes one more value from the stack than indicated by <em>m</em>, so the list of <a href="http://www.secg.org/sec2-v2.pdf" target="_blank" rel="noopener noreferrer">secp256k1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> signatures in the signature script must be prefaced with an extra value (<code>OP_0</code>) which will be consumed but not used.</p> <p>由于在原始的比特币实现中必须保留一个差一错误，为了兼容性，“ OP _ checkmultisig”从堆栈中消耗的值比 m 所指示的多一个，因此签名脚本中的 secp256k1签名列表必须在前面加上一个额外值(OP _ 0) ，这个额外值将被消耗但不会被使用。</p> <p>The signature script must provide signatures in the same order as the corresponding public keys appear in the pubkey script or redeem script. See the description in <a href="https://developer.bitcoin.org/terms.html#term-op-checkmultisig" target="_blank" rel="noopener noreferrer">“OP_CHECKMULTISIG”<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for details.</p> <p>签名脚本必须按照 pubkey 脚本或赎回脚本中相应的公钥出现的顺序提供签名。有关详细信息，请参阅“ op_checkmultisig”中的描述。</p> <div class="language- extra-class"><pre class="language-text"><code>Pubkey script: &lt;m&gt; &lt;A pubkey&gt; [B pubkey] [C pubkey...] &lt;n&gt; OP_CHECKMULTISIG
Signature script: OP_0 &lt;A sig&gt; [B sig] [C sig...]
</code></pre></div><p>Although it’s not a separate transaction type, this is a P2SH multisig with 2-of-3:</p> <p>尽管它不是一个单独的交易类型，但它是一个 P2SH multisig，具有2-of-3:</p> <div class="language- extra-class"><pre class="language-text"><code>Pubkey script: OP_HASH160 &lt;Hash160(redeemScript)&gt; OP_EQUAL
Redeem script: &lt;OP_2&gt; &lt;A pubkey&gt; &lt;B pubkey&gt; &lt;C pubkey&gt; &lt;OP_3&gt; OP_CHECKMULTISIG
Signature script: OP_0 &lt;A sig&gt; &lt;C sig&gt; &lt;redeemScript&gt;
</code></pre></div><h3 id="pubkey公钥"><a href="#pubkey公钥" class="header-anchor">#</a> Pubkey公钥</h3> <p>Pubkey outputs are a simplified form of the P2PKH pubkey script, but they aren’t as secure as P2PKH, so they generally aren’t used in new transactions anymore.</p> <p>Pubkey 输出是 P2PKH Pubkey 脚本的简化形式，但是它们不像 P2PKH 那样安全，所以它们通常不再用于新的交易。</p> <div class="language- extra-class"><pre class="language-text"><code>Pubkey script: &lt;pubkey&gt; OP_CHECKSIG
Signature script: &lt;sig&gt;
</code></pre></div><h3 id="null-data-空数据"><a href="#null-data-空数据" class="header-anchor">#</a> Null Data 空数据</h3> <p><a href="https://developer.bitcoin.org/glossary.html#term-Null-data-transaction" target="_blank" rel="noopener noreferrer">Null data<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> transaction type relayed and mined by default in <a href="https://bitcoin.org/en/release/v0.9.0" target="_blank" rel="noopener noreferrer">Bitcoin Core 0.9.0<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and later that adds arbitrary data to a provably unspendable pubkey script that full nodes don’t have to store in their UTXO database. It is preferable to use null data transactions over transactions that bloat the UTXO database because they cannot be automatically pruned; however, it is usually even more preferable to store data outside transactions if possible.</p> <p>在比特币核心0.9.0以及更高版本中，默认情况下中继和挖掘空数据交易类型，将任意数据添加到一个可证明无法使用的公共密钥脚本中，完整的节点不必存储在它们的 UTXO 数据库中。最好在 UTXO 数据库膨胀的交易上使用空数据交易，因为它们不能被自动裁剪; 然而，如果可能的话，在交易外存储数据通常更可取。</p> <p>Consensus rules allow null data outputs up to the maximum allowed pubkey script size of 10,000 bytes provided they follow all other consensus rules, such as not having any data pushes larger than 520 bytes.</p> <p>一致性规则允许空数据输出最大允许的 pubkey 脚本大小为10,000字节，前提是它们遵循所有其他一致性规则，比如不允许任何数据推送大于520字节。</p> <p>Bitcoin Core 0.9.x to 0.10.x will, by default, relay and mine null data transactions with up to 40 bytes in a single data push and only one null data output that pays exactly 0 satoshis:</p> <p>在默认情况下，比特币 Core 0.9.x to 0.10.x 将在一个数据推送中使用最多40字节的空数据交易，并且只有一个空数据输出支付0 satoshis:</p> <p>Pubkey Script: OP_RETURN &lt;0 to 40 bytes of data&gt;
(Null data scripts cannot be spent, so there's no signature script.)</p> <p>Bitcoin Core 0.11.x increases this default to 80 bytes, with the other rules remaining the same.</p> <p>11.x 将这个默认值增加到80字节，其他规则保持不变。</p> <p>Bitcoin Core 0.12.0 defaults to relaying and mining null data outputs with up to 83 bytes with any number of data pushes, provided the total byte limit is not exceeded. There must still only be a single null data output and it must still pay exactly 0 satoshis.</p> <p>比特币核心0.12.0默认中继和挖掘空数据输出83字节与任何数量的数据推，只要总字节限制不超过。仍然必须只有一个空数据输出，并且仍然必须支付正好0个卫星。</p> <p>The <code>-datacarriersize</code> Bitcoin Core configuration option allows you to set the maximum number of bytes in null data outputs that you will relay or mine.</p> <ul><li>datacarriersize Bitcoin Core 配置选项允许您设置空数据输出的最大字节数，您将中继或采矿。</li></ul> <h3 id="non-standard-transactions-非标准交易"><a href="#non-standard-transactions-非标准交易" class="header-anchor">#</a> Non-Standard Transactions 非标准交易</h3> <p>If you use anything besides a standard pubkey script in an output, peers and miners using the default Bitcoin Core settings will neither accept, broadcast, nor mine your transaction. When you try to broadcast your transaction to a peer running the default settings, you will receive an error.</p> <p>如果你在输出中使用除了标准的 pubkey 脚本之外的任何东西，使用默认比特币核心设置的同行和矿工将不会接受、广播或挖掘你的交易。当您尝试将交易广播给运行默认设置的对等方时，您将收到一个错误。</p> <p>If you create a redeem script, hash it, and use the hash in a P2SH output, the <a href="https://developer.bitcoin.org/devguide/p2p_network.html" target="_blank" rel="noopener noreferrer">network<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> sees only the hash, so it will accept the output as valid no matter what the redeem script says. This allows payment to non-standard scripts, and as of Bitcoin Core 0.11, almost all valid redeem scripts can be spent. The exception is scripts that use unassigned <a href="https://en.bitcoin.it/wiki/Script#Reserved_words" target="_blank" rel="noopener noreferrer">NOP opcodes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>; these opcodes are reserved for future soft forks and can only be relayed or mined by nodes that don’t follow the standard mempool policy.</p> <p>如果您创建一个赎回脚本，哈希它，并在 P2SH 输出中使用哈希，那么网络只能看到哈希，因此无论赎回脚本说什么，它都将接受输出为有效。这允许支付非标准的脚本，并作为核心的比特币0.11，几乎所有有效的赎回脚本可以花费。例外的是使用未分配 NOP 操作码的脚本; 这些操作码被预留给未来的软分叉，只能由不遵循标准 mempool 策略的节点中继或挖掘。</p> <p>Note: standard transactions are designed to protect and help the <a href="https://developer.bitcoin.org/devguide/p2p_network.html" target="_blank" rel="noopener noreferrer">network<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, not prevent you from making mistakes. It’s easy to create standard transactions which make the satoshis sent to them unspendable.</p> <p>注意: 标准交易的设计是为了保护和帮助网络，而不是防止你犯错。很容易创建标准的交易，使 satoshis 发送给他们不可消费。</p> <p>As of <a href="https://bitcoin.org/en/release/v0.9.3" target="_blank" rel="noopener noreferrer">Bitcoin Core 0.9.3<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, standard transactions must also meet the following conditions:</p> <p>从比特币核心0.9.3开始，标准交易也必须满足以下条件:</p> <ul><li><p>The transaction must be finalized: either its locktime must be in the past (or less than or equal to the current block height), or all of its sequence numbers must be 0xffffffff.</p> <p>交易必须完成: 它的锁定时间必须是在过去(或者小于或等于当前块高度) ，或者它的所有序列号必须是0xffffffff。</p></li> <li><p>The transaction must be smaller than 100,000 bytes. That’s around 200 times larger than a typical single-input, single-output P2PKH transaction.</p> <p>交易必须小于100,000字节，这大约是典型的单输入单输出 P2PKH 交易的200倍。</p></li> <li><p>Each of the transaction’s signature scripts must be smaller than 1,650 bytes. That’s large enough to allow 15-of-15 multisig transactions in P2SH using compressed public keys.</p> <p>每个交易的签名脚本必须小于1,650字节。这个大小足以允许 P2SH 中使用压缩公钥的15个多重信息交易中的15个。</p></li> <li><p>Bare (non-P2SH) multisig transactions which require more than 3 public keys are currently non-standard.</p> <p>裸(非 p2sh)多重信息交易需要超过3个公钥，目前是非标准的。</p></li> <li><p>The transaction’s signature script must only push data to the script evaluation stack. It cannot push new opcodes, with the exception of opcodes which solely push data to the stack.</p> <p>交易的签名脚本只能将数据推送到脚本计算堆栈。它不能推送新的操作码，除了只将数据推送到堆栈的操作码。</p></li> <li><p>The transaction must not include any outputs which receive fewer than 1/3 as many satoshis as it would take to spend it in a typical input. That’s <a href="https://github.com/bitcoin/bitcoin/commit/6a4c196dd64da2fd33dc7ae77a8cdd3e4cf0eff1" target="_blank" rel="noopener noreferrer">currently 546 satoshis<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for a P2PKH or P2SH output on a Bitcoin Core node with the default relay fee. Exception: standard null data outputs must receive zero satoshis.</p> <p>交易不得包括任何得到的产出少于一个典型投入所需的卫星数量的1/3。目前有546个 satoshis 用于比特币核心节点上的 P2PKH 或 P2SH 输出，并且默认支付中继费。异常: 标准空数据输出必须接收零卫星数据。</p></li></ul> <h2 id="signature-hash-types-签名哈希类型"><a href="#signature-hash-types-签名哈希类型" class="header-anchor">#</a> Signature Hash Types 签名哈希类型</h2> <p><a href="https://developer.bitcoin.org/terms.html#term-op-checksig" target="_blank" rel="noopener noreferrer"><code>OP_CHECKSIG</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> extracts a non-stack argument from each signature it evaluates, allowing the signer to decide which parts of the transaction to sign. Since the signature protects those parts of the transaction from modification, this lets signers selectively choose to let other people modify their transactions.</p> <p>“ op_checksig”从它计算的每个签名中提取一个非堆栈参数，允许签名者决定签署交易的哪些部分。由于签名保护交易的这些部分不被修改，因此允许签名者有选择地选择让其他人修改他们的交易。</p> <p>The various options for what to sign are called <a href="https://developer.bitcoin.org/glossary.html#term-Signature-hash" target="_blank" rel="noopener noreferrer">signature hash<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> types. There are three base SIGHASH types currently available:</p> <p>签名的各种选项被称为签名哈希类型。目前有三种基本 SIGHASH 类型可用:</p> <ul><li><p><a href="https://developer.bitcoin.org/glossary.html#term-SIGHASH_ALL" target="_blank" rel="noopener noreferrer">“SIGHASH_ALL”<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, the default, signs all the inputs and outputs, protecting everything except the signature scripts against modification.</p> <p>默认的“ SIGHASH _ all”为所有输入和输出签名，保护除签名脚本以外的所有内容不被修改。</p></li> <li><p><a href="https://developer.bitcoin.org/glossary.html#term-SIGHASH_NONE" target="_blank" rel="noopener noreferrer">“SIGHASH_NONE”<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> signs all of the inputs but none of the outputs, allowing anyone to change where the satoshis are going unless other signatures using other signature hash flags protect the outputs.</p> <p>“ SIGHASH _ none”标记所有输入，但没有输出，允许任何人改变 satoshis 的去向，除非其他签名使用其他签名哈希标志保护输出。</p></li> <li><p><a href="https://developer.bitcoin.org/glossary.html#term-SIGHASH_SINGLE" target="_blank" rel="noopener noreferrer">“SIGHASH_SINGLE”<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> the only output signed is the one corresponding to this input (the output with the same <a href="https://developer.bitcoin.org/terms.html#term-output-index" target="_blank" rel="noopener noreferrer">output index<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> number as this input), ensuring nobody can change your part of the transaction but allowing other signers to change their part of the transaction. The corresponding output must exist or the value “1” will be signed, breaking the security scheme. This input, as well as other inputs, are included in the signature. The sequence numbers of other inputs are not included in the signature, and can be updated.</p> <p>“ SIGHASH _ single”唯一的已签名输出是与此输入对应的输出(输出索引号与此输入相同) ，确保没有人可以更改交易的您部分，但允许其他签名者更改交易的其他部分。相应的输出必须存在，否则将对值“1”进行签名，从而破坏安全方案。这个输入以及其他输入都包含在签名中。其他输入的序列号不包含在签名中，可以更新。</p></li></ul> <p>The base types can be modified with the <a href="https://developer.bitcoin.org/glossary.html#term-SIGHASH_ANYONECANPAY" target="_blank" rel="noopener noreferrer">“SIGHASH_ANYONECANPAY”<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (anyone can pay) flag, creating three new combined types:</p> <p>基本类型可以用“ SIGHASH _ anyonecanpay”标志(任何人都可以付费)修改，创建三种新的组合类型:</p> <ul><li><p><code>SIGHASH_ALL|SIGHASH_ANYONECANPAY</code> signs all of the outputs but only this one input, and it also allows anyone to add or remove other inputs, so anyone can contribute additional satoshis but they cannot change how many satoshis are sent nor where they go.</p> <p>标记所有的输出，但只有这一个输入，它还允许任何人添加或删除其他输入，所以任何人都可以贡献额外的 satoshis，但他们不能改变有多少 satoshis 被发送或他们去哪里。</p></li> <li><p><code>SIGHASH_NONE|SIGHASH_ANYONECANPAY</code> signs only this one input and allows anyone to add or remove other inputs or outputs, so anyone who gets a copy of this input can spend it however they’d like.</p> <p>SIGHASH none | SIGHASH anyonecanpay 只签署这一个输入，并允许任何人添加或删除其他输入或输出，所以任何人谁得到这个输入的副本可以花它任何他们想要的。</p></li> <li><p><code>SIGHASH_SINGLE|SIGHASH_ANYONECANPAY</code> signs this one input and its corresponding output. Allows anyone to add or remove other inputs.</p> <p>SIGHASH _ single | SIGHASH _ anyonecanpay 为此输入及其相应的输出签名。允许任何人添加或删除其他输入。</p></li></ul> <p>Because each input is signed, a transaction with multiple inputs can have multiple signature hash types signing different parts of the transaction. For example, a single-input transaction signed with <code>NONE</code> could have its output changed by the miner who adds it to the block chain. On the other hand, if a two-input transaction has one input signed with <code>NONE</code> and one input signed with <code>ALL</code>, the <code>ALL</code> signer can choose where to spend the satoshis without consulting the <code>NONE</code> signer—but nobody else can modify the transaction.</p> <p>因为每个输入都是签名的，所以具有多个输入的交易可以具有多个签名哈希类型，对交易的不同部分进行签名。例如，使用 NONE 签名的单输入交易可能会由将其添加到块链中的采矿者更改其输出。另一方面，如果一个双输入交易有一个输入带 NONE 签名，一个输入带 ALL 签名，则 ALL 签名者可以选择在哪里使用 satoshis，而无需咨询 NONE 签名者ーー但其他任何人都不能修改该交易。</p> <h2 id="locktime-and-sequence-number-锁定时间和序列号"><a href="#locktime-and-sequence-number-锁定时间和序列号" class="header-anchor">#</a> Locktime And Sequence Number 锁定时间和序列号</h2> <p>One thing all signature hash types sign is the transaction’s <a href="https://developer.bitcoin.org/glossary.html#term-Locktime" target="_blank" rel="noopener noreferrer">locktime<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. (Called nLockTime in the Bitcoin Core source code.) The locktime indicates the earliest time a transaction can be added to the block chain.</p> <p>所有签名的哈希类型的标志之一是交易的锁定时间。(在比特币核心源代码中称为 nLockTime)锁定时间表示交易可以添加到块链的最早时间。</p> <p>Locktime allows signers to create time-locked transactions which will only become valid in the future, giving the signers a chance to change their minds.</p> <p>Locktime 允许签名者创建只在将来才有效的时间锁定交易，给签名者一个改变他们想法的机会。</p> <p>If any of the signers change their mind, they can create a new non-locktime transaction. The new transaction will use, as one of its inputs, one of the same outputs which was used as an input to the locktime transaction. This makes the locktime transaction invalid if the new transaction is added to the block chain before the time lock expires.</p> <p>如果任何签名者改变了主意，他们可以创建一个新的非锁定时间交易。新交易将使用与锁定时间交易相同的输出之一作为其输入之一。如果在时间锁过期之前将新交易添加到块链，则锁定时间交易无效。</p> <p>Care must be taken near the expiry time of a time lock. The <a href="https://developer.bitcoin.org/devguide/p2p_network.html" target="_blank" rel="noopener noreferrer">peer-to-peer network<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> allows block time to be up to two hours ahead of real time, so a locktime transaction can be added to the block chain up to two hours before its time lock officially expires. Also, blocks are not created at guaranteed intervals, so any attempt to cancel a valuable transaction should be made a few hours before the time lock expires.</p> <p>必须在时间锁的到期时间附近小心。对等网络允许块时间提前两个小时，所以锁定时间交易可以在正式时间锁失效前两个小时添加到块链中。此外，块不是按保证的间隔创建的，因此任何取消有价值交易的尝试都应该在时间锁过期之前几个小时进行。</p> <p>Previous versions of Bitcoin Core provided a feature which prevented transaction signers from using the method described above to cancel a time-locked transaction, but a necessary part of this feature was disabled to prevent denial of service attacks. A legacy of this system are four-byte <a href="https://developer.bitcoin.org/glossary.html#term-Sequence-number" target="_blank" rel="noopener noreferrer">sequence numbers<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> in every input. Sequence numbers were meant to allow multiple signers to agree to update a transaction; when they finished updating the transaction, they could agree to set every input’s sequence number to the four-byte unsigned maximum (0xffffffff), allowing the transaction to be added to a block even if its time lock had not expired.</p> <p>早期版本的比特币核心提供了一个功能，可以防止交易签署者使用上述方法取消一个时间锁定的交易，但是这个功能的一个必要部分被禁用，以防止分布式拒绝服务攻击攻击。这个系统的一个遗留问题是每个输入中都有四个字节的序列号。序列号意味着允许多个签名者同意更新交易; 当他们完成更新交易时，他们可以同意将每个输入的序列号设置为四字节的无签名最大值(0xffffffff) ，这样即使交易的时间锁没有过期，也可以将交易添加到一个块中。</p> <p>Even today, setting all sequence numbers to 0xffffffff (the default in Bitcoin Core) can still disable the time lock, so if you want to use locktime, at least one input must have a sequence number below the maximum. Since sequence numbers are not used by the <a href="https://developer.bitcoin.org/devguide/p2p_network.html" target="_blank" rel="noopener noreferrer">network<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for any other purpose, setting any sequence number to zero is sufficient to enable locktime.</p> <p>即使在今天，将所有序列号设置为0xffffff (比特币核心的默认值)仍然可以禁用时间锁，所以如果你想使用锁定时间，至少有一个输入的序列号必须低于最大值。由于序列号不会被网络用于任何其他目的，所以将任何序列号设置为零就足以启用锁定时间。</p> <p>Locktime itself is an unsigned 4-byte integer which can be parsed two ways:</p> <p>Locktime 本身是一个无符号4字节的整数，可以通过两种方式进行解析:</p> <ul><li><p>If less than 500 million, locktime is parsed as a block height. The transaction can be added to any block which has this height or higher.</p> <p>如果小于5亿，则 locktime 被解析为块高度。交易可以添加到具有此高度或更高的任何块。</p></li> <li><p>If greater than or equal to 500 million, locktime is parsed using the <a href="https://en.wikipedia.org/wiki/Unix_time" target="_blank" rel="noopener noreferrer">Unix epoch time<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> format (the number of seconds elapsed since 1970-01-01T00:00 UTC—currently over 1.395 billion). The transaction can be added to any block whose block time is greater than the locktime.</p> <p>如果大于或等于5亿，则使用 Unix epoch 时间格式解析 locktime (自1970-01-01T00:00 utc ー目前超过13.95亿)。交易可以添加到任何阻塞时间大于锁定时间的块中。</p></li></ul> <h2 id="transaction-fees-and-change-交易费用及找零"><a href="#transaction-fees-and-change-交易费用及找零" class="header-anchor">#</a> Transaction Fees And Change 交易费用及找零</h2> <p>Transactions pay fees based on the total byte size of the signed transaction. Fees per byte are calculated based on current demand for space in mined blocks with fees rising as demand increases. The transaction fee is given to the Bitcoin miner, as explained in the <a href="https://developer.bitcoin.org/devguide/block_chain.html" target="_blank" rel="noopener noreferrer">block chain section<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, and so it is ultimately up to each miner to choose the minimum transaction fee they will accept.</p> <p>交易根据已签名交易的总字节大小支付费用。每个字节的费用是根据当前开采区块的空间需求计算的，费用随着需求的增加而增加。交易费用是给比特币矿商的，正如块链部分所解释的，因此最终取决于每个矿商选择他们将接受的最低交易费用。</p> <p>There is also a concept of so-called “<a href="https://developer.bitcoin.org/glossary.html#term-High-priority-transaction" target="_blank" rel="noopener noreferrer">high-priority transactions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>” which spend satoshis that have not moved for a long time.</p> <p>还有一种所谓的“高优先级交易”的概念，即花费很长时间没有移动的 satoshis。</p> <p>In the past, these “priority” transaction were often exempt from the normal fee requirements. Before Bitcoin Core 0.12, 50 KB of each block would be reserved for these high-priority transactions, however this is now set to 0 KB by default. After the priority area, all transactions are prioritized based on their fee per byte, with higher-paying transactions being added in sequence until all of the available space is filled.</p> <p>在过去，这些“优先权”交易往往不受正常收费要求的限制。在比特币核心0.12之前，每个块的50 KB 被预留给这些高优先级的交易，但是现在默认设置为0 KB。在优先级区域之后，所有交易都根据每个字节的费用进行优先级排序，并按顺序添加付费较高的交易，直到所有可用空间都被填满。</p> <p>As of Bitcoin Core 0.9, a <a href="https://developer.bitcoin.org/glossary.html#term-Minimum-relay-fee" target="_blank" rel="noopener noreferrer">minimum fee<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (currently 1,000 satoshis) has been required to broadcast a transaction across the <a href="https://developer.bitcoin.org/devguide/p2p_network.html" target="_blank" rel="noopener noreferrer">network<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Any transaction paying only the minimum fee should be prepared to wait a long time before there’s enough spare space in a block to include it. Please see the <a href="https://developer.bitcoin.org/devguide/payment_processing.html#verifying-payment" target="_blank" rel="noopener noreferrer">verifying payment section<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for why this could be important.</p> <p>从比特币核心0.9开始，通过网络广播交易需要最低费用(目前是1000个 satoshis)。任何只支付最低费用的交易都应该准备等待很长一段时间，直到一个块中有足够的空闲空间来包含它。请查看核实付款部分为什么这可能是重要的。</p> <p>Since each transaction spends Unspent Transaction Outputs (UTXOs) and because a UTXO can only be spent once, the full value of the included UTXOs must be spent or given to a miner as a transaction fee. Few people will have UTXOs that exactly match the amount they want to pay, so most transactions include a change output.</p> <p>由于每个交易都会花费未用的交易输出(UTXOs) ，而且因为一个 UTXO 只能花费一次，所以必须将包含的 UTXOs 的全部价值作为交易费用花费或给予矿工。很少有人拥有与他们想要支付的金额完全匹配的 UTXOs，因此大多数交易都包含一个更改输出。</p> <p><a href="https://developer.bitcoin.org/glossary.html#term-Change-address" target="_blank" rel="noopener noreferrer">Change outputs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> are regular outputs which spend the surplus satoshis from the UTXOs back to the spender. They can reuse the same P2PKH pubkey hash or P2SH script hash as was used in the UTXO, but for the reasons described in the <a href="https://developer.bitcoin.org/devguide/transactions.html#avoiding-key-reuse" target="_blank" rel="noopener noreferrer">next subsection<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, it is highly recommended that change outputs be sent to a new P2PKH or P2SH address.</p> <p>变化输出是将剩余的卫星从 UTXOs 返回到消费者的定期输出。它们可以重用 UTXO 中使用的相同 P2PKH pubkey 哈希或 P2SH 脚本哈希，但由于下一小节所述的原因，强烈建议将更改输出发送到新的 P2PKH 或 P2SH 地址。</p> <h2 id="avoiding-key-reuse-避免重复使用密钥"><a href="#avoiding-key-reuse-避免重复使用密钥" class="header-anchor">#</a> Avoiding Key Reuse 避免重复使用密钥</h2> <p>In a transaction, the spender and receiver each reveal to each other all public keys or addresses used in the transaction. This allows either person to use the public block chain to track past and future transactions involving the other person’s same public keys or addresses.</p> <p>在交易中，消费者和接收者各自向对方披露交易中使用的所有公钥或地址。这允许任何一个人使用公共块链来跟踪过去和未来涉及其他人的相同公共密钥或地址的交易。</p> <p>If the same public key is reused often, as happens when people use Bitcoin addresses (hashed public keys) as static payment addresses, other people can easily track the receiving and spending habits of that person, including how many satoshis they control in known addresses.</p> <p>如果同一个公钥经常被重用，就像人们使用比特币地址(哈希公钥)作为静态支付地址时发生的情况一样，其他人可以很容易地跟踪这个人的接收和消费习惯，包括他们在已知地址中控制了多少 satoshis。</p> <p>It doesn’t have to be that way. If each public key is used exactly twice—once to receive a payment and once to spend that payment—the user can gain a significant amount of financial privacy.</p> <p>事情不一定非得这样。如果每个公钥只被使用两次ーー一次用于接收付款，一次用于支出付款ーー用户就可以获得大量的财务隐私。</p> <p>Even better, using new public keys or <a href="https://developer.bitcoin.org/terms.html#term-unique-address" target="_blank" rel="noopener noreferrer">unique addresses<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> when accepting payments or creating change outputs can be combined with other techniques discussed later, such as CoinJoin or <a href="https://developer.bitcoin.org/terms.html#term-merge-avoidance" target="_blank" rel="noopener noreferrer">merge avoidance<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, to make it extremely difficult to use the block chain by itself to reliably track how users receive and spend their satoshis.</p> <p>更好的是，在接受付款或创建变更输出时使用新的公钥或唯一地址可以与后面讨论的其他技术结合起来，比如硬币连接或合并规避，这使得单独使用区块链来可靠地跟踪用户如何接收和使用他们的卫星变得极其困难。</p> <p>Avoiding key reuse can also provide security against attacks which might allow reconstruction of private keys from public keys (hypothesized) or from signature comparisons (possible today under certain circumstances described below, with more general attacks hypothesized).</p> <p>避免密钥重用还可以提供安全性，防止可能从公钥(假设)或从签名比较(假设有更普遍的攻击)重建私钥的攻击。</p> <ol><li><p>Unique (non-reused) P2PKH and P2SH addresses protect against the first type of attack by keeping <a href="https://en.wikipedia.org/wiki/Elliptic_Curve_DSA" target="_blank" rel="noopener noreferrer">ECDSA<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> public keys hidden (hashed) until the first time satoshis sent to those addresses are spent, so attacks are effectively useless unless they can reconstruct private keys in less than the hour or two it takes for a transaction to be well protected by the block chain.</p> <p>唯一的(不可重用的) P2PKH 和 P2SH 地址通过将 ECDSA 公钥隐藏(哈希化)直到第一次发送到这些地址的 satoshis 被使用来防止第一种类型的攻击，因此攻击实际上是没有用的，除非它们能够在不到一两个小时的时间内重构私钥，否则交易就会被块链很好地保护。</p></li> <li><p>Unique (non-reused) private keys protect against the second type of attack by only generating one signature per private key, so attackers never get a subsequent signature to use in comparison-based attacks. Existing comparison-based attacks are only practical today when insufficient entropy is used in signing or when the entropy used is exposed by some means, such as a <a href="https://en.wikipedia.org/wiki/Side_channel_attack" target="_blank" rel="noopener noreferrer">side-channel attack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>唯一的(不可重用的)私钥通过每个私钥只生成一个签名来防止第二种类型的攻击，因此攻击者在基于比较的攻击中无法获得后续的签名。现有的基于比较的攻击只有在签名中使用了不充分的熵或者使用了某种方法(如边信道攻击)暴露了熵的情况下才是实用的。</p></li></ol> <p>So, for both privacy and security, we encourage you to build your applications to avoid public key reuse and, when possible, to discourage users from reusing addresses. If your application needs to provide a fixed URI to which payments should be sent, please see the <a href="https://developer.bitcoin.org/devguide/payment_processing.html#bitcoin-uri" target="_blank" rel="noopener noreferrer">“bitcoin:” URI section<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> below.</p> <p>因此，为了保护隐私和安全，我们鼓励您构建应用程序，以避免公钥重用，并尽可能阻止用户重用地址。如果您的应用程序需要提供一个固定的 URI，支付应该发送，请参阅下面的“比特币: ” URI 部分。</p> <h2 id="transaction-malleability-交易延展性"><a href="#transaction-malleability-交易延展性" class="header-anchor">#</a> Transaction Malleability 交易延展性</h2> <p>None of Bitcoin’s signature hash types protect the signature script, leaving the door open for a limited denial of service attack called <a href="https://developer.bitcoin.org/glossary.html#term-Transaction-malleability" target="_blank" rel="noopener noreferrer">transaction malleability<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>{:.term}{:#term-transaction-malleability}. The signature script contains the <a href="http://www.secg.org/sec2-v2.pdf" target="_blank" rel="noopener noreferrer">secp256k1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> signature, which can’t sign itself, allowing attackers to make non-functional modifications to a transaction without rendering it invalid. For example, an attacker can add some data to the signature script which will be dropped before the previous pubkey script is processed.</p> <p>没有一种比特币的签名哈希类型能够保护签名脚本，这就为一种名为交易延展性的有限的分布式拒绝服务攻击攻击敞开了大门。{ : # term-transaction-malability }.签名脚本包含 secp256k1签名，该签名本身不能签名，允许攻击者对交易进行非功能性修改，而不会导致交易无效。例如，攻击者可以向签名脚本添加一些数据，这些数据将在处理前一个 pubkey 脚本之前被删除。</p> <p>Although the modifications are non-functional—so they do not change what inputs the transaction uses nor what outputs it pays—they do change the computed hash of the transaction. Since each transaction links to previous transactions using hashes as a transaction identifier (txid), a modified transaction will not have the txid its creator expected.</p> <p>虽然这些修改是非功能性的ーー因此它们不会改变交易使用的输入和支付的输出ーー但它们确实会改变交易的计算哈希。由于每个交易使用哈希作为交易标识符(txid)链接到以前的交易，因此修改后的交易不会具有预期的 txid 创建者。</p> <p>This isn’t a problem for most Bitcoin transactions which are designed to be added to the block chain immediately. But it does become a problem when the output from a transaction is spent before that transaction is added to the block chain.</p> <p>对于大多数比特币交易来说，这不是一个问题，因为它们被设计成立即添加到块链中。但是，当交易的输出在添加到块链之前就被花费时，这就成了一个问题。</p> <p>Bitcoin developers have been working to reduce transaction malleability among standard transaction types, one outcome of those efforts is <a href="https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki" target="_blank" rel="noopener noreferrer">BIP 141: Segregated Witness<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, which is supported by Bitcoin Core and was activated in August 2017. When SegWit is not being used, new transactions should not depend on previous transactions which have not been added to the block chain yet, especially if large amounts of satoshis are at stake.</p> <p>比特币开发商一直在努力减少标准交易类型之间的交易可塑性，这些努力的成果之一是 BIP 141: Segregated Witness，它得到了比特币核心的支持，于2017年8月被激活。当 SegWit 不被使用时，新的交易不应该依赖于以前的交易，这些交易还没有被添加到区块链中，特别是如果大量的 satoshis 处于危险之中。</p> <p>Transaction malleability also affects payment tracking. Bitcoin Core’s <a href="https://developer.bitcoin.org/reference/rpc/index.html" target="_blank" rel="noopener noreferrer">RPC<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> interface lets you track transactions by their txid—but if that txid changes because the transaction was modified, it may appear that the transaction has disappeared from the <a href="https://developer.bitcoin.org/devguide/p2p_network.html" target="_blank" rel="noopener noreferrer">network<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>交易延展性也会影响支付跟踪。比特币核心的 RPC 接口可以让你通过它们的 txid 跟踪交易，但是如果由于交易被修改而导致 txid 发生变化，那么这个交易可能看起来已经从网络中消失了。</p> <p>Current best practices for transaction tracking dictate that a transaction should be tracked by the transaction outputs (UTXOs) it spends as inputs, as they cannot be changed without invalidating the transaction.</p> <p>当前交易跟踪的最佳实践规定，交易应该由其作为输入花费的交易输出(UTXOs)来跟踪，因为如果不使交易无效，就不能更改交易。</p> <p>Best practices further dictate that if a transaction does seem to disappear from the <a href="https://developer.bitcoin.org/devguide/p2p_network.html" target="_blank" rel="noopener noreferrer">network<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and needs to be reissued, that it be reissued in a way that invalidates the lost transaction. One method which will always work is to ensure the reissued payment spends all of the same outputs that the lost transaction used as inputs.</p> <p>最佳实践进一步规定，如果交易确实似乎从网络中消失并需要重新发出，则应以使丢失的交易无效的方式重新发出该交易。一种始终有效的方法是确保重新发放的付款使用与损失的交易用作投入的所有产出相同的产出。</p></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#introduction-引言" title="Introduction 引言">Introduction 引言</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#交易的构造" title="交易的构造">交易的构造</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#花费一个输出" title="花费一个输出">花费一个输出</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#创建-p2pkh-公钥哈希以接收付款" title="创建 P2PKH 公钥哈希以接收付款">创建 P2PKH 公钥哈希以接收付款</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#解锁一个-p2pkh-输出用于支出" title="解锁一个 P2PKH 输出用于支出">解锁一个 P2PKH 输出用于支出</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#花费支出是签名的一些东西" title="花费支出是签名的一些东西">花费支出是签名的一些东西</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#p2pkh-script-validation-p2pkh-脚本验证" title="P2PKH Script Validation P2PKH 脚本验证">P2PKH Script Validation P2PKH 脚本验证</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#p2pkh-堆栈计算" title="P2PKH 堆栈计算">P2PKH 堆栈计算</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#p2sh-scripts-p2sh-脚本" title="P2SH Scripts P2SH 脚本">P2SH Scripts P2SH 脚本</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#standard-transactions-标准交易" title="Standard Transactions 标准交易">Standard Transactions 标准交易</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#pay-to-public-key-hash-p2pkh-支付到公钥哈希-p2pkh" title="Pay To Public Key Hash (P2PKH) 支付到公钥哈希(P2PKH)">Pay To Public Key Hash (P2PKH) 支付到公钥哈希(P2PKH)</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#pay-to-script-hash-p2sh-支付到脚本哈希-p2sh" title="Pay To Script Hash (P2SH) 支付到脚本哈希(P2SH)">Pay To Script Hash (P2SH) 支付到脚本哈希(P2SH)</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#multisig-多签" title="Multisig 多签">Multisig 多签</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#pubkey公钥" title="Pubkey公钥">Pubkey公钥</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#null-data-空数据" title="Null Data 空数据">Null Data 空数据</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#non-standard-transactions-非标准交易" title="Non-Standard Transactions 非标准交易">Non-Standard Transactions 非标准交易</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#signature-hash-types-签名哈希类型" title="Signature Hash Types 签名哈希类型">Signature Hash Types 签名哈希类型</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#locktime-and-sequence-number-锁定时间和序列号" title="Locktime And Sequence Number 锁定时间和序列号">Locktime And Sequence Number 锁定时间和序列号</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#transaction-fees-and-change-交易费用及找零" title="Transaction Fees And Change 交易费用及找零">Transaction Fees And Change 交易费用及找零</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#avoiding-key-reuse-避免重复使用密钥" title="Avoiding Key Reuse 避免重复使用密钥">Avoiding Key Reuse 避免重复使用密钥</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#transaction-malleability-交易延展性" title="Transaction Malleability 交易延展性">Transaction Malleability 交易延展性</a></div></div></div></div> <footer class="footer" data-v-3d9deeb8><div class="footer-left-wrap" data-v-3d9deeb8><ul class="contact" data-v-3d9deeb8><li class="contact-item" data-v-3d9deeb8><a href="https://github.com/baryon" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-3d9deeb8><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-3d9deeb8><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-3d9deeb8></path></svg>
          
        </a></li><li class="contact-item" data-v-3d9deeb8><a href="mailto:lilong@gmail.com" class="nav-link external" data-v-3d9deeb8><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail" data-v-3d9deeb8><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" data-v-3d9deeb8></path><polyline points="22,6 12,13 2,6" data-v-3d9deeb8></polyline></svg>
          
        </a></li><li class="contact-item" data-v-3d9deeb8><a href="https://twitter.com/lilong" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-3d9deeb8><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter" data-v-3d9deeb8><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z" data-v-3d9deeb8></path></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-3d9deeb8><ul class="copyright" data-v-3d9deeb8><li class="copyright-item" data-v-3d9deeb8><a href="/about/" class="nav-link" data-v-3d9deeb8>LI Long © 2020</a></li><li class="copyright-item" data-v-3d9deeb8><a href="/" class="nav-link" data-v-3d9deeb8>Made with ❤</a></li><li class="copyright-item" data-v-3d9deeb8><a href="https://creativecommons.org/licenses/by-nc-sa/2.5/cn/" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-3d9deeb8>CC BY-NC-SA 2.5</a></li></ul></div></footer></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.abf5d3ec.js" defer></script><script src="/assets/js/8.ce1c8cc9.js" defer></script><script src="/assets/js/3.414e57ad.js" defer></script><script src="/assets/js/41.fb9be79b.js" defer></script>
  </body>
</html>
